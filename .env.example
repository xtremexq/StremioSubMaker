# SubMaker - Stremio Subtitle Translator
# Environment Configuration

# ======================
# REQUIRED - API Keys and Server Configuration
# ======================

# OpenSubtitles Developer API Key (REQUIRED)
OPENSUBTITLES_API_KEY=

# Port to run the server on (default: 7001)
PORT=7001

# Node environment: development or production
NODE_ENV=production

# Log level: 'debug' (all logs), 'warn' (warnings + errors), 'error' (errors only)
LOG_LEVEL=warn

# Storage type: "filesystem" (default) or "redis"
# Use "filesystem" for local development with npm start
# Use "redis" for production/HA deployment with Docker
STORAGE_TYPE=redis

# ======================
# IMPORTANT - Storage Configuration
# ======================

# Redis Configuration (only needed if STORAGE_TYPE=redis)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=stremio

# ======================
# Translation Performance
# ======================

# Gemini chunk concurrency (IMPORTANT for performance tuning)
# How many subtitle chunks to process in parallel during large translations
# Default: 1 (sequential mode - safe, no API rate limit risk)
# Set to 3-5 for parallel processing (3-5x faster, but may hit API rate limits)
#
# Recommendations:
# - Start with 1 (sequential) and monitor translation times
# - If translations are slow and you're not hitting API limits, increase to 3
# - Monitor your Gemini API quota at https://aistudio.google.com/app/apikey
# - If you see 429 errors (rate limit), reduce back to 1 or 2
#
# GEMINI_CHUNK_CONCURRENCY=1

# Cache Size Limits (in bytes)
# CRITICAL: Total cache size MUST be less than Redis maxmemory setting!
# Default: 6GB total (fits in 8GB Redis with 2GB overhead)
#
# For larger deployments with more RAM:
# - Set Redis maxmemory to 120GB+
# - Increase these limits proportionally
# - Example: CACHE_LIMIT_TRANSLATION=53687091200 (50GB)
#
# CACHE_LIMIT_TRANSLATION=3221225472  # 3GB (default) - permanent translations
# CACHE_LIMIT_BYPASS=1073741824       # 1GB (default) - temporary user cache (12h TTL)
# CACHE_LIMIT_PARTIAL=1073741824      # 1GB (default) - in-progress translations (1h TTL)
# CACHE_LIMIT_SYNC=1073741824         # 1GB (default) - synced subtitles

# ======================
# Redis High Availability (OPTIONAL - Enterprise Deployments)
# ======================

# Redis Sentinel for automatic failover (disabled by default)
# Only enable this for production HA deployments with Redis Sentinel
# Single-user deployments should leave this disabled
# REDIS_SENTINEL_ENABLED=false

# Sentinel configuration (only used if REDIS_SENTINEL_ENABLED=true)
# Comma-separated list of sentinel nodes (host:port)
# Example: REDIS_SENTINELS=sentinel1:26379,sentinel2:26379,sentinel3:26379
# REDIS_SENTINELS=localhost:26379

# Sentinel master name (default: mymaster)
# REDIS_SENTINEL_NAME=mymaster

# ======================
# Session Management
# ======================

# Session expiration time in milliseconds (sliding expiration - resets on each use)
# Default: 7776000000 (90 days / 3 months)
# Sessions only expire after this period of complete inactivity
SESSION_MAX_AGE=7776000000

# Auto-save interval for session persistence (in milliseconds)
# How often to save sessions to disk
# Default: 300000 (5 minutes)
SESSION_SAVE_INTERVAL=300000

# Path to store session data on disk
# Sessions are saved here and reloaded on server restart
# Default: ./data/sessions.json
SESSION_PERSISTENCE_PATH=./data/sessions.json

# Session store is unbounded by count by default.
# To enforce a cap, set MAX_SESSIONS to a positive integer.
# Example:
# MAX_SESSIONS=1000

# ======================
# Security Configuration
# ======================

# Encryption key for sensitive user data (API keys, passwords)
# Must be 64 hex characters (32 bytes) for AES-256-GCM encryption
# If not provided, a key will be auto-generated and saved to .encryption-key file
# IMPORTANT: Back up this key! Loss of this key means loss of encrypted data.
# Generate a key: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# ENCRYPTION_KEY=

# Force session-based authentication even on localhost
# Set to 'true' to disable base64 encoding on localhost (for testing production behavior)
# Default: not set (allows base64 on localhost for development convenience)
# FORCE_SESSIONS=true

# Allow base64-encoded configs in production (NOT RECOMMENDED)
# Only enable this if you need backward compatibility
# Default: not set (base64 configs disabled in production)
# ALLOW_BASE64_CONFIG=true

# ======================
# Logging Configuration
# ======================

# Control console logging verbosity via LOG_LEVEL
# Levels: 'debug' (all logs), 'warn' (warnings + errors only), 'error' (errors only)
# Default: 'debug' (development mode)
# For production, set to 'error' to show only errors
# LOG_LEVEL=error

# Write logs to file (enabled by default in production)
# Set to 'false' to disable file logging even in production
# Default: true in production, false in development
# LOG_TO_FILE=true

# Directory for log files (default: ./logs)
# LOG_DIR=./logs

# Log file name (default: app.log)
# LOG_BASENAME=app.log

# Maximum size of a single log file in MB (default: 10)
# LOG_MAX_SIZE_MB=10

# Maximum number of archived log files to keep (default: 100)
# LOG_MAX_FILES=100

# Maximum age of log files in days before auto-deletion (default: 14)
# LOG_MAX_AGE_DAYS=14

# ======================
# High-Performance Logging
# ======================

# Log sampling rate for high-load scenarios (0.0 to 1.0, default: 1.0 = no sampling)
# Example: 0.1 = log only 10% of messages (reduces I/O and CPU overhead)
# Useful for HA deployments with thousands of requests per second
# LOG_SAMPLE_RATE=1.0

# Only sample debug logs (default: false)
# When true, only debug logs are sampled; warn/error logs are always logged
# Recommended for production: set to true to ensure critical messages aren't lost
# LOG_SAMPLE_DEBUG_ONLY=true

# ======================
# Performance Tuning (ADVANCED)
# ======================

# Entry cache size (default: 50000)
# In-memory cache for individual subtitle entries
# Higher values = better cache hit rates but more RAM usage
# Estimate: 50K entries â‰ˆ 5-10MB RAM
# ENTRY_CACHE_SIZE=50000

# Partial cache flush timing (adaptive - optimized for user experience)
# First partial save: Quick initial feedback (default: 15000 = 15 seconds)
# Subsequent saves: Reduced I/O frequency (default: 30000 = 30 seconds)
#
# PARTIAL_FIRST_FLUSH_MS=15000      # First partial delivery (quick user feedback)
# PARTIAL_FLUSH_INTERVAL_MS=30000   # Subsequent partial deliveries (reduced I/O)

# ======================
# Production Deployment
# ======================

# For VPS deployment, set these:
# NODE_ENV=production
# PORT=7001
# SESSION_MAX_AGE=7776000000

# Make sure your reverse proxy (nginx/apache) passes these headers:
# - X-Forwarded-Proto (for HTTPS detection)
# - X-Forwarded-For (for rate limiting)

# ======================
# Development/Testing
# ======================

# For local development, you can use defaults:
# NODE_ENV=development
# PORT=7001

# To test production session behavior on localhost:
# FORCE_SESSIONS=true