<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubMaker - Configure</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.svg">
    <link rel="apple-touch-icon" href="favicon.svg">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        :root {
            --primary: #08A4D5;
            --primary-light: #33B9E1;
            --primary-dark: #068DB7;
            --secondary: #33B9E1;
            --accent: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #f7fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #eef2f7;
            --surface: #ffffff;
            --surface-light: #f3f7fb;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border: #dbe3ea;
            --shadow: rgba(0, 0, 0, 0.08);
            --glow: rgba(8, 164, 213, 0.25);
        }

        /* Dark mode color scheme */
        [data-theme="dark"] {
            --primary: #08A4D5;
            --primary-light: #33B9E1;
            --primary-dark: #068DB7;
            --secondary: #33B9E1;
            --accent: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #0A0E27;
            --bg-secondary: #141931;
            --bg-tertiary: #1a1f3a;
            --surface: #141931;
            --surface-light: #1E2539;
            --text-primary: #E8EAED;
            --text-secondary: #9AA0A6;
            --border: #2A3247;
            --shadow: rgba(0, 0, 0, 0.3);
            --glow: rgba(8, 164, 213, 0.35);
        }

        /* True Dark mode (Blackhole) color scheme */
        [data-theme="true-dark"] {
            --primary: #08A4D5;
            --primary-light: #33B9E1;
            --primary-dark: #068DB7;
            --secondary: #33B9E1;
            --accent: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #111111;
            --surface: #0a0a0a;
            --surface-light: #151515;
            --text-primary: #E8EAED;
            --text-secondary: #8A8A8A;
            --border: #1a1a1a;
            --shadow: rgba(0, 0, 0, 0.8);
            --glow: rgba(8, 164, 213, 0.45);
        }

        /* Dark mode specific overrides */
        [data-theme="dark"] body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 60%, var(--bg-primary) 100%);
        }

        [data-theme="dark"] body::before {
            background:
                radial-gradient(circle at 20% 50%, rgba(8, 164, 213, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(51, 185, 225, 0.15) 0%, transparent 50%);
        }

        [data-theme="dark"] .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
        }

        [data-theme="dark"] .card {
            background: rgba(20, 25, 49, 0.85);
        }

        [data-theme="dark"] input[type="text"],
        [data-theme="dark"] input[type="password"],
        [data-theme="dark"] select {
            background: var(--surface-light);
            color: var(--text-primary);
        }

        [data-theme="dark"] input[type="text"]::placeholder,
        [data-theme="dark"] input[type="password"]::placeholder {
            color: #64748b;
        }

        /* Dark mode keyboard hint contrast fix */
        [data-theme="dark"] .keyboard-hint {
            background: rgba(20, 25, 49, 0.9);
            color: var(--text-primary);
            border-color: var(--border);
        }

        /* Fix radio button label backgrounds in dark mode */
        /* Unselected options should be darker */
        [data-theme="dark"] label:has(input[type="radio"]:not(:checked))[style*="background: white"] {
            background: var(--bg-secondary) !important;
        }

        /* Selected option should be lighter/brighter */
        [data-theme="dark"] label:has(input[type="radio"]:checked)[style*="background: white"] {
            background: var(--surface-light) !important;
            border-color: var(--primary) !important;
        }

        /* True Dark mode (Blackhole) specific overrides */
        [data-theme="true-dark"] body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 60%, var(--bg-primary) 100%);
        }

        [data-theme="true-dark"] body::before {
            background:
                radial-gradient(circle at 20% 50%, rgba(8, 164, 213, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(51, 185, 225, 0.08) 0%, transparent 50%);
        }

        [data-theme="true-dark"] .modal-overlay {
            background: rgba(0, 0, 0, 0.9);
        }

        [data-theme="true-dark"] .card {
            background: rgba(10, 10, 10, 0.95);
        }

        [data-theme="true-dark"] input[type="text"],
        [data-theme="true-dark"] input[type="password"],
        [data-theme="true-dark"] select {
            background: var(--surface-light);
            color: var(--text-primary);
        }

        [data-theme="true-dark"] input[type="text"]::placeholder,
        [data-theme="true-dark"] input[type="password"]::placeholder {
            color: #4a4a4a;
        }

        [data-theme="true-dark"] .keyboard-hint {
            background: rgba(10, 10, 10, 0.95);
            color: var(--text-primary);
            border-color: var(--border);
        }

        [data-theme="true-dark"] label:has(input[type="radio"]:not(:checked))[style*="background: white"] {
            background: var(--bg-secondary) !important;
        }

        [data-theme="true-dark"] label:has(input[type="radio"]:checked)[style*="background: white"] {
            background: var(--surface-light) !important;
            border-color: var(--primary) !important;
        }

        [data-theme="true-dark"] .theme-toggle {
            background: rgba(10, 10, 10, 0.95);
            border-color: var(--border);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #ffffff 60%, var(--bg-primary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(8, 164, 213, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(51, 185, 225, 0.12) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 20%;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .logo {
            width: 100px;
            height: 100px;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 60px var(--glow);
            animation: float 3s ease-in-out infinite;
            position: relative;
        }

        .logo::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 24px;
            z-index: -1;
            opacity: 0.5;
            filter: blur(20px);
        }

        .logo img {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.125rem;
            font-weight: 500;
        }

        /* Card System */
        .card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 8px 24px var(--shadow);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) backwards;
        }

        .card:hover {
            border-color: var(--primary);
            box-shadow: 0 12px 48px var(--glow);
            transform: translateY(-2px);
        }

        .card.collapsed .card-content {
            display: none;
        }

        .card.collapsed {
            padding: 1.5rem 2rem;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
        }

        .card-title-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px var(--glow);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .card-badge {
            display: none;
            align-items: center;
            justify-content: center;
            min-width: 28px;
            height: 28px;
            padding: 0 0.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 14px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-left: 0.5rem;
            animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .collapse-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.25rem;
            margin-left: 0.5rem;
        }

        .collapse-btn:hover {
            background: rgba(8, 164, 213, 0.1);
            border-color: var(--primary);
        }

        .collapse-btn.collapsed::before {
            content: '‚ñº';
        }

        .collapse-btn:not(.collapsed)::before {
            content: '‚ñ≤';
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 56px;
            height: 32px;
            cursor: pointer;
        }

        .toggle-switch input {
            display: none;
        }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: var(--surface-light);
            border-radius: 32px;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border: 2px solid var(--border);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            left: 2px;
            top: 2px;
            background: var(--text-secondary);
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-color: var(--primary);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(24px);
            background: white;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .label-description {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 400;
            margin-top: 0.25rem;
        }

        input[type="text"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            font-family: inherit;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--glow);
            transform: translateY(-1px);
        }

        input.invalid,
        select.invalid {
            border-color: var(--danger);
            animation: shake 0.3s ease;
        }

        input.valid,
        select.valid {
            border-color: var(--success);
        }

        .field-error {
            color: var(--danger);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
            animation: fadeInUp 0.3s ease;
        }

        .field-error.show {
            display: block;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Password Toggle Eye Icon */
        .password-field-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .password-field-wrapper input[type="password"],
        .password-field-wrapper input[type="text"] {
            padding-right: 3rem;
        }

        .password-toggle-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            user-select: none;
            z-index: 10;
        }

        .password-toggle-icon:hover {
            color: var(--primary);
            transform: translateY(-50%) scale(1.1);
        }

        /* Language Selector - Modern Chips */
        .language-search {
            position: relative;
            margin-bottom: 1rem;
        }

        .language-search input {
            padding-left: 2.5rem;
        }

        .language-search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        .selected-languages {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 42px;
            padding: 0.5rem;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .selected-languages:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--glow);
        }

        .selected-languages.empty::before {
            content: 'Click languages below to add...';
            color: var(--text-secondary);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            height: 26px;
        }

        .language-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            animation: chipIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .language-chip:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--glow);
        }

        .language-chip .remove {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }

        .language-chip .remove:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.75rem;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: var(--surface);
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .language-grid::-webkit-scrollbar {
            width: 8px;
        }

        .language-grid::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 4px;
        }

        .language-grid::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .language-item {
            padding: 0.75rem 1rem;
            background: var(--surface-light);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            user-select: none;
        }

        .language-item:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--glow);
        }

        .language-item.selected {
            background: linear-gradient(135deg, rgba(8, 164, 213, 0.18) 0%, rgba(51, 185, 225, 0.18) 100%);
            border-color: var(--primary);
            color: var(--primary-dark);
        }

        .language-item.hidden {
            display: none;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 0.5rem 1rem;
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-btn:hover {
            border-color: var(--primary);
            color: var(--primary-dark);
            background: rgba(8, 164, 213, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: 0 8px 24px var(--glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px var(--glow);
        }

        .btn-secondary {
            background: var(--surface-light);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            background: rgba(8, 164, 213, 0.1);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        /* Alert System */
        .alert {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
            max-width: 500px;
            z-index: 9999;
            animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 12px 48px var(--shadow);
            backdrop-filter: blur(20px);
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--danger);
            color: var(--danger);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.2);
            border: 2px solid var(--warning);
            color: var(--warning);
        }

        .alert-info {
            background: rgba(8, 164, 213, 0.12);
            border: 2px solid var(--primary);
            color: var(--primary-dark);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(6px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }

        .loading-overlay.show {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--surface-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Model Fetching Status */
        .model-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .model-status.fetching {
            color: var(--primary-light);
        }

        .model-status.success {
            color: var(--success);
        }

        .model-status.error {
            color: var(--danger);
        }

        .model-status .spinner-small {
            width: 16px;
            height: 16px;
            border: 2px solid var(--surface-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes chipIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Keyboard shortcuts hint */
        .keyboard-hint {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 0.875rem;
            color: var(--text-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 1000;
        }

        .keyboard-hint.show {
            opacity: 1;
        }

        .kbd {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.875rem;
            color: var(--primary-light);
            margin: 0 0.25rem;
        }

        /* Install URL Display */
        .install-url-box {
            margin-top: 1.5rem;
            display: none;
        }

        .install-url-box.show {
            display: block;
        }

        .install-url-box label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .install-url-box input {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: monospace;
            cursor: text;
        }

        .install-url-box input:focus {
            outline: none;
            box-shadow: 0 0 0 4px var(--glow);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 3rem 2rem;
            margin-top: 4rem;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .footer-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .footer-heart {
            color: var(--danger);
            animation: heartPulse 3s ease-in-out infinite;
            display: inline-block;
            text-shadow: 0 0 0 transparent;
            transition: all 0.3s ease;
        }

        .footer p {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        .footer a {
            color: var(--primary-light);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .footer a:hover {
            color: var(--primary);
        }

        @keyframes heartPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.9;
                text-shadow: 0 0 0 transparent;
            }
            50% {
                transform: scale(1.08);
                opacity: 1;
                text-shadow: 0 0 12px rgba(239, 68, 68, 0.4);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            .card {
                padding: 1.5rem;
            }

            .card.collapsed {
                padding: 1rem 1.5rem;
            }

            .language-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                max-height: 300px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .alert {
                right: 1rem;
                left: 1rem;
                min-width: auto;
            }

            .keyboard-hint {
                display: none;
            }

            .selected-languages {
                max-height: 150px;
                overflow-y: auto;
            }
        }

        /* Disabled file translation option */
        #fileTranslationEnabled:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        #fileTranslationEnabled:disabled + span {
            color: var(--text-secondary);
        }

        label:has(#fileTranslationEnabled:disabled) {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Stagger animations */
        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }
        .card:nth-child(5) { animation-delay: 0.5s; }

        /* Modal System */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            /* Clip scrollbars within rounded corners */
            overflow: hidden;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px var(--glow), 0 0 0 1px rgba(8, 164, 213, 0.2);
            animation: modalSlideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 2rem;
            border-bottom: 2px solid var(--border);
            background: linear-gradient(135deg, rgba(8, 164, 213, 0.10) 0%, rgba(51, 185, 225, 0.10) 100%);
            position: sticky;
            top: 0;
            z-index: 1;
            backdrop-filter: blur(10px);
        }

        .modal-header h2 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 36px;
            height: 36px;
            background: var(--surface-light);
            border: 2px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.25rem;
            color: var(--text-secondary);
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--danger);
            color: var(--danger);
            transform: rotate(90deg);
        }

        .modal-content {
            padding: 2rem;
            text-align: center;
            /* Make only content area scrollable */
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1 1 auto;
            /* Keep layout centered even when scrollbar appears */
            scrollbar-gutter: stable both-edges;
        }

        .modal-content h3 {
            color: var(--primary-light);
            font-size: 1.125rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .modal-content h3:first-child {
            margin-top: 0;
        }

        .modal-content ol {
            margin: 0.75rem auto;
            padding-left: 1.5rem;
            color: var(--text-primary);
            line-height: 1.8;
            text-align: left;
            max-width: fit-content;
        }

        .modal-content li {
            margin: 0.5rem 0;
            color: var(--text-primary);
        }

        .modal-content p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin: 0.75rem 0;
        }

        .modal-content strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .modal-content em {
            color: var(--warning);
            font-style: normal;
            font-weight: 600;
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 2px solid var(--border);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            position: sticky;
            bottom: 0;
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
        }

        /* In-modal scrollbar styling (WebKit/Blink) */
        .modal-content::-webkit-scrollbar {
            width: 10px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: var(--surface-light);
            border-radius: 12px;
            /* Keep track inset from header/footer to avoid visual bleed */
            margin: 8px;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 8px;
            border: 2px solid var(--surface-light);
        }
        /* Firefox scrollbar styling */
        .modal-content {
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--surface-light);
        }

        .modal-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-right: auto;
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            user-select: none;
        }

        .modal-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .highlight-box {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .highlight-box p {
            color: var(--warning);
            font-weight: 600;
            margin: 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Scrollbar for modal */
        .modal::-webkit-scrollbar {
            width: 10px;
        }

        .modal::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 0 24px 24px 0;
        }

        .modal::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
        }

        .modal::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }

        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white !important;
            -webkit-text-fill-color: white !important;
            border: none;
            border-radius: 999px;
            padding: 0.35rem 0.85rem;
            font-size: 0.85rem;
            font-weight: 700;
            margin-left: 0.75rem;
            vertical-align: middle;
            box-shadow: 0 4px 12px rgba(8, 164, 213, 0.4);
            letter-spacing: 0.5px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Validation Buttons */
        .validate-api-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 0.625rem 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.375rem;
            transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(8, 164, 213, 0.25);
            min-width: 85px;
            justify-content: center;
        }

        .validate-api-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(8, 164, 213, 0.4);
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary) 100%);
        }

        .validate-api-btn:active {
            transform: translateY(0);
        }

        .validate-api-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .validate-api-btn.validating {
            background: linear-gradient(135deg, var(--text-secondary) 0%, #64748b 100%);
            pointer-events: none;
        }

        .validate-api-btn.validating .validate-icon {
            animation: spin 1s linear infinite;
        }

        .validate-api-btn.success {
            background: linear-gradient(135deg, var(--success) 0%, #34d399 100%);
        }

        .validate-api-btn.error {
            background: linear-gradient(135deg, var(--danger) 0%, #f87171 100%);
        }

        .validate-icon {
            font-size: 1rem;
            display: inline-block;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .validation-feedback {
            margin-top: 0.5rem;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.875rem;
            display: none;
            animation: slideDown 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .validation-feedback.show {
            display: block;
        }

        .validation-feedback.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #059669;
        }

        .validation-feedback.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }

        .validation-feedback.info {
            background: rgba(8, 164, 213, 0.1);
            border: 1px solid rgba(8, 164, 213, 0.3);
            color: var(--primary-dark);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 2rem;
            right: 2rem;
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 9999;
            box-shadow: 0 4px 12px var(--shadow);
            backdrop-filter: blur(10px);
        }

        [data-theme="dark"] .theme-toggle {
            background: rgba(20, 25, 49, 0.9);
            border-color: var(--border);
        }

        .theme-toggle:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 20px var(--shadow);
            border-color: var(--primary);
        }

        .theme-toggle:active {
            transform: translateY(0) scale(0.98);
        }

        .theme-toggle-icon {
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .theme-toggle-icon.sun {
            display: block;
        }

        .theme-toggle-icon.moon {
            display: none;
        }

        .theme-toggle-icon.blackhole {
            display: none;
        }

        [data-theme="dark"] .theme-toggle-icon.sun {
            display: none;
        }

        [data-theme="dark"] .theme-toggle-icon.moon {
            display: block;
        }

        [data-theme="dark"] .theme-toggle-icon.blackhole {
            display: none;
        }

        [data-theme="true-dark"] .theme-toggle-icon.sun {
            display: none;
        }

        [data-theme="true-dark"] .theme-toggle-icon.moon {
            display: none;
        }

        [data-theme="true-dark"] .theme-toggle-icon.blackhole {
            display: block;
        }

        @media (max-width: 768px) {
            .theme-toggle {
                top: 1rem;
                right: 1rem;
                width: 42px;
                height: 42px;
            }

            .theme-toggle-icon {
                font-size: 1.25rem;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
        <span class="theme-toggle-icon sun">‚òÄÔ∏è</span>
        <span class="theme-toggle-icon moon">üåô</span>
        <span class="theme-toggle-icon blackhole">üï≥Ô∏è</span>
    </button>

    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="logo.png" alt="SubMaker Logo" style="width: 80px; height: 80px; border-radius: 20px;">
            </div>
            <h1>SubMaker <span id="version-badge" class="version-badge" style="display:none;"></span></h1>
            <p class="subtitle">AI-Powered Subtitle Translation</p>
        </div>

        <div id="alertContainer"></div>

        <script>
        (function(){
            try {
                fetch('/api/session-stats', { cache: 'no-store' })
                    .then(function(r){ return r.ok ? r.json() : null; })
                    .then(function(d){
                        if (!d || !d.version) return;

                        // Show version badge
                        var el = document.getElementById('version-badge');
                        if (el) { el.textContent = 'v' + d.version; el.style.display = 'inline-block'; }
                        // Optionally cache-bust logo image
                        var logo = document.querySelector('.logo img');
                        if (logo && logo.src && logo.src.indexOf('?v=') === -1) {
                            logo.src = logo.src + (logo.src.indexOf('?') === -1 ? '?v=' : '&v=') + d.version;
                        }
                    })
                    .catch(function(){});
            } catch (_) {}
        })();
        </script>

        <form id="configForm">
            <!-- No Translation Mode Toggle -->
            <div style="margin: 2rem 0; padding: 1.5rem; background: var(--surface-light); border: 2px solid var(--border); border-radius: 12px; display: flex; align-items: center; gap: 1rem;">
                <span style="font-size: 1.75rem;">‚è∏Ô∏è</span>
                <div style="flex: 1;">
                    <span style="display: block; font-weight: 600; color: var(--text-primary);">Just Fetch Subtitles (No Translation)</span>
                    <span style="display: block; font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">Skip AI translation and just fetch subtitles in your chosen languages</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="noTranslationMode">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <!-- Subtitle API Providers -->
            <div class="card collapsed" data-card="subtitle-api">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon">üìö</div>
                        <h2 class="card-title">Subtitles API Keys</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="subtitle-api"></button>
                </div>
                <div class="card-content">
                                        <!-- OpenSubtitles -->
                    <div class="form-group" style="padding-bottom: 1.5rem; border-bottom: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <label style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">üìÑ</span>
                                <div>
                                    <strong style="display: block;">OpenSubtitles</strong>
                                    <span class="label-description" style="margin: 0;">Choose your preferred OpenSubtitles implementation below.</span>
                                </div>
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableOpenSubtitles" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="opensubtitlesConfig">
                            <!-- Implementation Type Selection -->
                            <div style="margin-bottom: 1rem; padding: 1rem; background: var(--surface-light); border-radius: 8px;">
                                <label style="display: block; margin-bottom: 0.75rem; font-weight: 600;">Implementation Type</label>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <label style="display: flex; align-items: start; gap: 0.5rem; cursor: pointer; padding: 0.75rem; background: white; border: 2px solid var(--border); border-radius: 8px; transition: all 0.2s;">
                                        <input type="radio" name="opensubtitlesImplementation" id="opensubtitlesImplV3" value="v3" checked style="margin-top: 0.25rem;">
                                        <div>
                                            <strong style="display: block; margin-bottom: 0.25rem;">V3 (Default)</strong>
                                            <span class="label-description" style="margin: 0; font-size: 0.875rem;">Uses the official Stremio OpenSubtitles V3 addon. No authentication required, simple setup.</span>
                                        </div>
                                    </label>
                                    <label style="display: flex; align-items: start; gap: 0.5rem; cursor: pointer; padding: 0.75rem; background: white; border: 2px solid var(--border); border-radius: 8px; transition: all 0.2s;">
                                        <input type="radio" name="opensubtitlesImplementation" id="opensubtitlesImplAuth" value="auth" style="margin-top: 0.25rem;">
                                        <div>
                                            <strong style="display: block; margin-bottom: 0.25rem;">Auth</strong>
                                            <span class="label-description" style="margin: 0; font-size: 0.875rem;">Uses your OpenSubtitles account with API key authentication. Requires username/password.</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Auth Configuration (shown when Auth is selected) -->
                            <div id="opensubtitlesAuthConfig" style="display: none;">
                                <label style="display: block; margin-bottom: 0.5rem;">Username</label>
                                <input type="text" id="opensubtitlesUsername" placeholder="Enter your OpenSubtitles username" style="margin-bottom: 0.75rem;">

                                <label style="display: block; margin-bottom: 0.5rem;">Password</label>
                                <div class="password-field-wrapper" style="margin-bottom: 0.75rem;">
                                    <input type="password" id="opensubtitlesPassword" placeholder="Enter your OpenSubtitles password">
                                    <span class="password-toggle-icon" id="toggleOpenSubsPassword" title="Show/hide password">üëÅÔ∏è</span>
                                </div>

                                <span class="label-description"><a href="https://www.opensubtitles.com/en/newuser" target="_blank" style="color: var(--primary-light);">Create a free account</a> if you don't have one.</span>
                            </div>
                        </div>
                    </div>

                    <!-- SubSource -->
                    <div class="form-group" style="padding: 1.5rem 0; border-bottom: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <label style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">üé¨</span>
                                <div>
                                    <strong style="display: block;">SubSource</strong>
                                    <span class="label-description" style="margin: 0;">Get your free API key from <a href="https://subsource.net/" target="_blank" style="color: var(--primary-light);">SubSource.net</a></span>
                                </div>
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableSubSource" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="subsourceConfig">
                            <div style="display: flex; gap: 0.5rem; align-items: start;">
                                <input type="text" id="subsourceApiKey" placeholder="Enter SubSource API key" style="flex: 1;">
                                <button type="button" class="validate-api-btn" id="validateSubSource" title="Validate API key">
                                    <span class="validate-icon">‚úì</span>
                                    <span class="validate-text">Test</span>
                                </button>
                            </div>
                            <div class="validation-feedback" id="subsourceValidationFeedback"></div>
                        </div>
                    </div>

                    <!-- SubDL -->
                    <div class="form-group" style="padding: 1.5rem 0; border-bottom: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <label style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">üìã</span>
                                <div>
                                    <strong style="display: block;">SubDL</strong>
                                    <span class="label-description" style="margin: 0;">Get your free API key from <a href="https://subdl.com" target="_blank" style="color: var(--primary-light);">SubDL.com</a></span>
                                </div>
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableSubDL" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="subdlConfig">
                            <div style="display: flex; gap: 0.5rem; align-items: start;">
                                <input type="text" id="subdlApiKey" placeholder="Enter SubDL API key" style="flex: 1;">
                                <button type="button" class="validate-api-btn" id="validateSubDL" title="Validate API key">
                                    <span class="validate-icon">‚úì</span>
                                    <span class="validate-text">Test</span>
                                </button>
                            </div>
                            <div class="validation-feedback" id="subdlValidationFeedback"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- No-Translation Languages -->
            <div class="card collapsed" id="noTranslationCard" style="display: none;" data-card="notranslation">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon">üì∫</div>
                        <h2 class="card-title">Languages</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="notranslation"></button>
                </div>

                <div class="card-content">
                    <div class="form-group">
                        <label>
                            Subtitle Languages
                            <span class="label-description">Select which languages you want to fetch subtitles in.</span>
                        </label>

                        <div class="language-search">
                            <span class="language-search-icon">üîç</span>
                            <input type="text" id="noTranslationSearch" placeholder="Search languages...">
                        </div>

                        <div id="selectedNoTranslationLanguages" class="selected-languages empty"></div>

                        <div class="quick-actions">
                            <button type="button" class="quick-btn" data-action="select-popular-notranslation">‚≠ê Popular</button>
                            <button type="button" class="quick-btn" data-action="select-all-notranslation">‚úì All</button>
                            <button type="button" class="quick-btn" data-action="clear-notranslation">‚úó Clear</button>
                        </div>

                        <div id="noTranslationLanguages" class="language-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Gemini API -->
            <div class="card collapsed" id="geminiCard" data-card="gemini">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon">‚ú®</div>
                        <h2 class="card-title">AI Translation API Keys</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="gemini"></button>
                </div>

                <div class="card-content">
                    <div class="form-group">
                        <label for="geminiApiKey">
                            Gemini API Key
                            <span class="label-description">Get your free API key from <a href="https://makersuite.google.com/app/apikey" target="_blank" style="color: var(--primary-light);">Google AI Studio</a></span>
                        </label>
                        <div style="display: flex; gap: 0.5rem; align-items: start;">
                            <input type="password" id="geminiApiKey" placeholder="Enter your Gemini API key" style="flex: 1;">
                            <button type="button" class="validate-api-btn" id="validateGemini" title="Validate API key">
                                <span class="validate-icon">‚úì</span>
                                <span class="validate-text">Test</span>
                            </button>
                        </div>
                        <div class="validation-feedback" id="geminiValidationFeedback"></div>
                        <div class="field-error" id="geminiApiKeyError">API key is required</div>
                    </div>

                    <div class="form-group">
                        <label for="geminiModel">
                            Translation Model
                            <span class="label-description">AI model for translations</span>
                        </label>
                        <select id="geminiModel" required>
                            <option value="gemini-2.5-flash-lite-preview-09-2025" selected>Gemini 2.5 Flash-Lite</option>
                            <option value="gemini-2.5-flash-preview-09-2025">Gemini 2.5 Flash</option>
                        </select>
                        <div class="field-error" id="geminiModelError">Please select a model</div>
                        <div style="margin-top: 0.75rem; padding: 0.75rem; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px; font-size: 0.875rem; color: var(--text-secondary);">
                            <strong style="color: var(--warning);">‚ö° Flash usage is still in Beta.</strong> If you have translation problems, use Flash-Lite.
                        </div>
                    </div>

                    <div class="form-group" style="display: none;">
                        <label for="promptStyle">
                            Prompt Style
                            <span class="label-description">Choose between strict structure preservation or natural flow adaptation</span>
                        </label>
                        <select id="promptStyle">
                            <option value="natural" disabled title="Temporarily unavailable">Natural - Adapts structure for natural target language flow</option>
                            <option value="strict">Strict - Preserves exact timing and structure</option>
                        </select>
                    </div>

                    <!-- Advanced Settings removed by request -->
                </div>
            </div>

            <!-- Source Languages -->
            <div class="card collapsed" id="sourceCard" data-card="source">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon">üåç</div>
                        <h2 class="card-title">Source Language</h2>
                        <span class="card-badge" id="sourceBadge">0</span>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="source"></button>
                </div>

                <div class="card-content">
                    <div class="form-group">
                        <label>
                            * Source languages for translations
                            <span class="label-description">You can select up to 3 source languages, but only 1 is recommended (so you have the same list order when translating). All subtitles from this language will be available for translation in the translation selector AND will be fetched (original subtitles will show up).</span>
                        </label>

                        <div class="language-search">
                            <span class="language-search-icon">üîç</span>
                            <input type="text" id="sourceSearch" placeholder="Search languages..." accesskey="s">
                        </div>

                        <div id="selectedSourceLanguages" class="selected-languages empty"></div>
                        <div class="field-error" id="sourceLanguagesError">Please select 1 source language</div>

                        <div id="sourceLanguages" class="language-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Target Languages -->
            <div class="card collapsed" id="targetCard" data-card="target">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon">üéØ</div>
                        <h2 class="card-title">Target Languages</h2>
                        <span class="card-badge" id="targetBadge">0</span>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="target"></button>
                </div>

                <div class="card-content">
                    <div class="form-group">
                        <label>
                            * Target languages for subtitles and translations
                            <span class="label-description">Subtitles in target languages will be fetched AND translation buttons will appear for translating FROM the source language TO these languages.</span>
                        </label>

                        <div class="language-search">
                            <span class="language-search-icon">üîç</span>
                            <input type="text" id="targetSearch" placeholder="Search languages..." accesskey="t">
                        </div>

                        <div id="selectedTargetLanguages" class="selected-languages empty"></div>
                        <div class="field-error" id="targetLanguagesError">Please select at least one target language</div>

                        <div class="quick-actions">
                            <button type="button" class="quick-btn" data-action="select-popular-target">‚≠ê Popular</button>
                            <button type="button" class="quick-btn" data-action="select-all-target">‚úì All</button>
                            <button type="button" class="quick-btn" data-action="clear-target">‚úó Clear</button>
                        </div>

                        <div id="targetLanguages" class="language-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Other Settings -->
            <div class="card collapsed" data-card="cache">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon">‚öôÔ∏è</div>
                        <h2 class="card-title">Other Settings</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="cache"></button>
                </div>

                <div class="card-content">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="fileTranslationEnabled">
                            Enable "Translate SRT"
                            <span class="label-description">Show the "Translate SRT" option in the subtitles list to upload and translate subtitles files directly.</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="cacheEnabled" checked>
                            Enable SubMaker Database
                            <span class="label-description">Reads and caches translated subtitles from/to our database. Avoids re-translating already-translated subtitles. Reduces API usage and improves performance.</span>
                        </label>
                    </div>

                    <div class="form-group" id="bypassCacheGroup">
                        <label>
                            <input type="checkbox" id="bypassCache">
                            Bypass SubMaker Database Cache (Force Retranslation)
                            <span class="label-description">Skips reading our database cache and do not save translated subtitles to it. Translations will be stored in a temporary cache (for 12 hours).</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="card collapsed" data-card="advanced" id="advancedSettingsCard" style="display: none;">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon">üî¨</div>
                        <h2 class="card-title">
                            Advanced Settings (EXPERIMENTAL)
                        </h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="advanced"></button>
                </div>

                <div class="card-content">
                    <div class="highlight-box" style="margin-bottom: 1.5rem;">
                        <p style="font-size: 0.9rem; margin: 0;">
                            <strong>Fine-tune AI behavior:</strong> Override default model and sampling parameters. When any setting is changed from defaults, <strong style="color: var(--warning);">Bypass Cache is automatically enabled</strong> to ensure your experimental translations don't pollute the shared database.
                        </p>
                    </div>

                    <div class="form-group">
                        <label for="advancedModel">
                            Translation Model Override
                            <span class="label-description">Override the default model. Leave empty to use system default (gemini-2.5-flash-lite-preview-09-2025).</span>
                        </label>
                        <select id="advancedModel">
                            <option value="">Use Default Model</option>
                        </select>
                        <div class="model-status" id="modelStatus"></div>
                    </div>

                    <div class="form-group">
                        <label for="advancedThinkingBudget">
                            Thinking Budget (Extended Reasoning)
                            <span class="label-description">0 = disabled, -1 = dynamic (auto-adjust), or fixed token count (1-32768). Higher values = deeper reasoning but slower.</span>
                        </label>
                        <input type="number" id="advancedThinkingBudget" min="-1" max="32768" step="1" value="0" placeholder="0">
                    </div>

                    <div class="form-group">
                        <label for="advancedTemperature">
                            Temperature (Creativity)
                            <span class="label-description">Controls randomness (0.0-2.0). Lower = more deterministic, Higher = more creative. Default: 0.8</span>
                        </label>
                        <input type="number" id="advancedTemperature" min="0" max="2" step="0.1" value="0.8" placeholder="0.8">
                    </div>

                    <div class="form-group">
                        <label for="advancedTopP">
                            Top-P (Nucleus Sampling)
                            <span class="label-description">Probability threshold (0.0-1.0). Lower = more focused, Higher = more diverse. Default: 0.95</span>
                        </label>
                        <input type="number" id="advancedTopP" min="0" max="1" step="0.05" value="0.95" placeholder="0.95">
                    </div>
                </div>
            </div>

            <!-- Dev Settings (hidden until Ctrl+Alt+D) -->
            <div class="card collapsed" data-card="dev" id="devSettingsCard" style="display: none;">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon">üß™</div>
                        <h2 class="card-title">Dev</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="dev"></button>
                </div>

                <div class="card-content">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="syncSubtitlesEnabled">
                            Enable "Sync Subtitles"
                            <span class="label-description">Show the "Sync Subtitles" option in the subtitles list to open the sync page for the current video.</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="btn-group">
                <button type="submit" class="btn btn-primary" accesskey="enter">
                    üíæ Save Configuration
                </button>
                <button type="button" class="btn btn-secondary" id="installBtn" disabled>
                    üöÄ Install in Stremio
                </button>
                <button type="button" class="btn btn-secondary" id="copyBtn" disabled>
                    üìã Copy Install URL
                </button>
            </div>

            <!-- Install URL Display -->
            <div class="install-url-box" id="installUrlBox">
                <label for="installUrlDisplay">Install URL</label>
                <input type="text" id="installUrlDisplay" readonly>
            </div>
        </form>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>
                Made with <span class="footer-heart" id="secretHeart" style="cursor: pointer; user-select: none;">‚ù§Ô∏è</span> for Stremio users everywhere
            </p>
            <p style="font-size: 0.875rem;">
                Thank you for using SubMaker! Your support helps make content accessible to everyone.
            </p>
        </div>
    </footer>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <div class="keyboard-hint" id="keyboardHint">
        Press <span class="kbd">?</span> for keyboard shortcuts
    </div>

    <!-- Main Instructions Modal -->
    <div class="modal-overlay" id="instructionsModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üìñ How to Use SubMaker</h2>
                <div class="modal-close" id="closeInstructionsBtn">√ó</div>
            </div>
            <div class="modal-content">
                <h3>üöÄ Usage Instructions:</h3>
                <ol>
                    <li>Add desired API keys to <strong>"Subtitles Sources"</strong> section.</li>
                    <li>Add a Gemini API Key to <strong>AI section</strong>.</li>
                    <li>Select <strong>source languages</strong>.</li>
                    <li>Select <strong>target languages</strong>.</li>
                    <li><strong>Install on Stremio</strong>.</li>
                </ol>

                <h3>üé¨ Stremio will:</h3>
                <p>1. Fetch all Source and Target languages subtitles from sources.<br>
                2. Create <strong>"Make [Target Language]"</strong> buttons within the subtitles list.<br>
		3. All "Make" translation lists are in the same order of the Source language list.</p>

                <h3>‚ö° When you click a subtitle:</h3>
                <p>When a subtitle is clicked within the "Make" translation lists, it'll start translation.<br>
		After 20-30 seconds, reload the same subtitle entry.<br>
                It'll load <strong>translated</strong>!</p>
                <p>-<br>
		<b>PS:</b>
		Partial translation is delivered in batches so you can start watching almost instantly.<br>
                Complete translation may take from <strong>30 seconds-5 minutes</strong> depending on movie/episode length.</p>

                <div class="highlight-box">
                    <p><em>*Only 1 source language recommended:*</em></p>
                    <p style="color: var(--text-secondary); font-weight: normal; margin-top: 0.5rem;">When the "Make" translation lists are created, they load the subtitles list in the same order of the source language.<br>That means you can test the source language subtitles for the correct sync and only then select the same one on the translation list instead of translating unsync'd subtitles.</p>
                </div>	
            </div>
            <div class="modal-footer">
                <label class="modal-checkbox">
                    <input type="checkbox" id="dontShowInstructions">
                    Don't show this again
                </label>
                <button type="button" class="btn btn-primary" id="gotItInstructionsBtn">
                    Got it!
                </button>
            </div>
        </div>
    </div>

    <!-- Translate SRT Instructions Modal -->
    <div class="modal-overlay" id="fileTranslationModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üìÅ Translate SRT Instructions</h2>
                <div class="modal-close" id="closeFileTranslationBtn">√ó</div>
            </div>
            <div class="modal-content">
                <h3>üì§ How to Use "Translate SRT":</h3>
                <ol>
                    <li>Enable it on the config page before installing.</li>
                    <li>Click <strong>"Translate SRT"</strong> in the subtitles list when streaming.</li>
                    <li>Right-click the stream or select the three-dots menu and click <strong>"Download Subtitles"</strong></li>
                    <li>A webpage will open on your browser.</li>
                    <li>Upload the .srt file you'd like to translate. It will use your Gemini API key.</li>
                    <li>When it's done, download the translated subtitles and drag it to Stremio.</li>
                </ol>
            </div>
            <div class="modal-footer">
                <label class="modal-checkbox">
                    <input type="checkbox" id="dontShowFileTranslation">
                    Don't show this again
                </label>
                <button type="button" class="btn btn-primary" id="gotItFileTranslationBtn">
                    Got it!
                </button>
            </div>
        </div>
    </div>

    <script>
    (function(){
        function loadConfigJs(versionQuery){
            var s = document.createElement('script');
            s.src = 'config.js' + versionQuery;
            s.defer = false;
            document.body.appendChild(s);
        }

        try {
            fetch('/api/session-stats', { cache: 'no-store' })
                .then(function(r){ return r.ok ? r.json() : null; })
                .then(function(d){
                    var vq = d && d.version ? ('?v=' + d.version) : ('?v=' + Date.now());
                    loadConfigJs(vq);
                })
                .catch(function(){
                    loadConfigJs('?v=' + Date.now());
                });
        } catch (e) {
            loadConfigJs('?v=' + Date.now());
        }
    })();

    // Theme switching functionality
    (function() {
        const html = document.documentElement;
        const themeToggle = document.getElementById('themeToggle');

        // Check for saved theme preference or default to system preference
        function getPreferredTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                return savedTheme;
            }

            // Check system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                return 'dark';
            }

            return 'light';
        }

        // Apply theme
        function setTheme(theme) {
            html.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        // Initialize theme on page load
        const initialTheme = getPreferredTheme();
        setTheme(initialTheme);

        // Toggle theme on button click - cycles through light ‚Üí dark ‚Üí true-dark ‚Üí light
        if (themeToggle) {
            themeToggle.addEventListener('click', function() {
                const currentTheme = html.getAttribute('data-theme') || 'light';
                let newTheme;

                if (currentTheme === 'light') {
                    newTheme = 'dark';
                } else if (currentTheme === 'dark') {
                    newTheme = 'true-dark';
                } else {
                    newTheme = 'light';
                }

                setTheme(newTheme);
            });
        }

        // Listen for system theme changes
        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                // Only auto-switch if user hasn't manually set a preference
                if (!localStorage.getItem('theme')) {
                    setTheme(e.matches ? 'dark' : 'light');
                }
            });
        }
    })();
    </script>

    <!-- Service Worker Registration for Cache Management -->
    <script>
        /**
         * Register service worker for automatic cache version management
         * This ensures users always get the latest version when deployed
         */
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js', { scope: '/' })
                    .then(function(reg) {
                        console.log('[SW Registration] Service worker registered successfully:', reg);

                        // Check for updates periodically (every hour)
                        setInterval(function() {
                            reg.update().then(function() {
                                console.log('[SW Update Check] Service worker update check completed');
                            }).catch(function(err) {
                                console.warn('[SW Update Check] Failed to check for updates:', err);
                            });
                        }, 60 * 60 * 1000); // 1 hour

                        // Listen for controller change (indicates new SW activated)
                        navigator.serviceWorker.addEventListener('controllerchange', function() {
                            console.log('[SW] Controller changed - new version activated');
                            // Optionally notify user of update
                            // You could show a banner here asking user to reload
                        });
                    })
                    .catch(function(err) {
                        console.warn('[SW Registration] Failed to register service worker:', err);
                    });
            });

            // Listen for messages from service worker
            navigator.serviceWorker.addEventListener('message', function(event) {
                console.log('[SW Message]', event.data);
            });
        } else {
            console.log('[SW] Service workers not supported in this browser');
        }
    </script>
</body>
</html>
