<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubMaker - Configure</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" href="favicon.svg">
    <!-- Retro fonts for ghost hint -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&family=Tiny5&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Removed global smooth scrolling to reduce perceived lag */

        :root {
            --primary: #08A4D5;
            --primary-light: #33B9E1;
            --primary-dark: #068DB7;
            --secondary: #33B9E1;
            --accent: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #f7fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #eef2f7;
            --surface: #ffffff;
            --surface-light: #f3f7fb;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border: #dbe3ea;
            --shadow: rgba(0, 0, 0, 0.08);
            --glow: rgba(8, 164, 213, 0.25);
        }

        /* Dark mode color scheme */
        [data-theme="dark"] {
            --primary: #08A4D5;
            --primary-light: #33B9E1;
            --primary-dark: #068DB7;
            --secondary: #33B9E1;
            --accent: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #0A0E27;
            --bg-secondary: #141931;
            --bg-tertiary: #1a1f3a;
            --surface: #141931;
            --surface-light: #1E2539;
            --text-primary: #E8EAED;
            --text-secondary: #9AA0A6;
            --border: #2A3247;
            --shadow: rgba(0, 0, 0, 0.3);
            --glow: rgba(8, 164, 213, 0.35);
        }

        /* True Dark mode (Blackhole) color scheme */
        [data-theme="true-dark"] {
            --primary: #08A4D5;
            --primary-light: #33B9E1;
            --primary-dark: #068DB7;
            --secondary: #33B9E1;
            --accent: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #111111;
            --surface: #0a0a0a;
            --surface-light: #151515;
            --text-primary: #E8EAED;
            --text-secondary: #8A8A8A;
            --border: #1a1a1a;
            --shadow: rgba(0, 0, 0, 0.8);
            --glow: rgba(8, 164, 213, 0.45);
        }

        /* Dark mode specific overrides */
        [data-theme="dark"] body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 60%, var(--bg-primary) 100%);
        }

        [data-theme="dark"] body::before {
            background:
                radial-gradient(circle at 20% 50%, rgba(8, 164, 213, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(51, 185, 225, 0.15) 0%, transparent 50%);
        }

        [data-theme="dark"] .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
        }

        [data-theme="dark"] .card {
            background: rgba(20, 25, 49, 0.85);
        }

        /* Dark mode modal + components tuning */
        [data-theme="dark"] .modal {
            background:
                linear-gradient(180deg, rgba(20, 25, 49, 0.92) 0%, rgba(20, 25, 49, 0.86) 100%),
                var(--surface);
            border-color: var(--border);
            box-shadow: 0 24px 72px var(--shadow), 0 0 0 1px rgba(8, 164, 213, 0.12);
        }
        [data-theme="dark"] .modal-header {
            background: linear-gradient(135deg, rgba(8, 164, 213, 0.06) 0%, rgba(51, 185, 225, 0.06) 100%);
            border-bottom-color: var(--border);
        }
        [data-theme="dark"] .modal-footer {
            background: var(--surface);
            border-top-color: var(--border);
        }
        [data-theme="dark"] .reset-bar {
            background: var(--surface);
            border-color: var(--border);
            box-shadow: 0 8px 24px var(--shadow);
        }
        [data-theme="dark"] .alert-info {
            background: rgba(8, 164, 213, 0.16);
            border-color: var(--primary);
            color: var(--primary-light);
        }

        [data-theme="dark"] input[type="text"],
        [data-theme="dark"] input[type="password"],
        [data-theme="dark"] select {
            background: var(--surface-light);
            color: var(--text-primary);
        }

        [data-theme="dark"] input[type="text"]::placeholder,
        [data-theme="dark"] input[type="password"]::placeholder {
            color: #64748b;
        }

        /* Dark mode keyboard hint contrast fix */
        [data-theme="dark"] .keyboard-hint {
            background: rgba(20, 25, 49, 0.9);
            color: var(--text-primary);
            border-color: var(--border);
        }

        /* Dark/True Dark overrides for ghost hint color */
        [data-theme="dark"] .ghost-hint .ghost-cta,
        [data-theme="true-dark"] .ghost-hint .ghost-cta {
            color: #ffffff;
            mix-blend-mode: screen;
        }
        [data-theme="dark"] .ghost-hint .ghost-arrow,
        [data-theme="true-dark"] .ghost-hint .ghost-arrow {
            color: #ffffff;
            mix-blend-mode: screen;
        }

        /* Fix radio button label backgrounds in dark mode */
        /* Unselected options should be darker */
        [data-theme="dark"] label:has(input[type="radio"]:not(:checked))[style*="background: white"] {
            background: var(--bg-secondary) !important;
        }

        /* Selected option should be lighter/brighter */
        [data-theme="dark"] label:has(input[type="radio"]:checked)[style*="background: white"] {
            background: var(--surface-light) !important;
            border-color: var(--primary) !important;
        }

        /* True Dark mode (Blackhole) specific overrides */
        [data-theme="true-dark"] body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 60%, var(--bg-primary) 100%);
        }

        [data-theme="true-dark"] body::before {
            background:
                radial-gradient(circle at 20% 50%, rgba(8, 164, 213, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(51, 185, 225, 0.08) 0%, transparent 50%);
        }

        [data-theme="true-dark"] .modal-overlay {
            background: rgba(0, 0, 0, 0.9);
        }

        [data-theme="true-dark"] .card {
            background: rgba(10, 10, 10, 0.95);
        }

        /* True Dark mode modal + components tuning */
        [data-theme="true-dark"] .modal {
            background:
                linear-gradient(180deg, rgba(10, 10, 10, 0.92) 0%, rgba(10, 10, 10, 0.86) 100%),
                var(--surface);
            border-color: var(--border);
            box-shadow: 0 28px 84px var(--shadow), 0 0 0 1px rgba(8, 164, 213, 0.14);
        }
        [data-theme="true-dark"] .modal-header {
            background: linear-gradient(135deg, rgba(8, 164, 213, 0.05) 0%, rgba(51, 185, 225, 0.05) 100%);
            border-bottom-color: var(--border);
        }
        [data-theme="true-dark"] .modal-footer {
            background: var(--surface);
            border-top-color: var(--border);
        }
        [data-theme="true-dark"] .reset-bar {
            background: var(--surface);
            border-color: var(--border);
            box-shadow: 0 10px 28px var(--shadow);
        }
        [data-theme="true-dark"] .alert-info {
            background: rgba(8, 164, 213, 0.18);
            border-color: var(--primary);
            color: #d6f3ff;
        }

        [data-theme="true-dark"] input[type="text"],
        [data-theme="true-dark"] input[type="password"],
        [data-theme="true-dark"] select {
            background: var(--surface-light);
            color: var(--text-primary);
        }

        [data-theme="true-dark"] input[type="text"]::placeholder,
        [data-theme="true-dark"] input[type="password"]::placeholder {
            color: #4a4a4a;
        }

        [data-theme="true-dark"] .keyboard-hint {
            background: rgba(10, 10, 10, 0.95);
            color: var(--text-primary);
            border-color: var(--border);
        }

        [data-theme="true-dark"] label:has(input[type="radio"]:not(:checked))[style*="background: white"] {
            background: var(--bg-secondary) !important;
        }

        [data-theme="true-dark"] label:has(input[type="radio"]:checked)[style*="background: white"] {
            background: var(--surface-light) !important;
            border-color: var(--primary) !important;
        }

        [data-theme="true-dark"] .theme-toggle {
            background: rgba(10, 10, 10, 0.95);
            border-color: var(--border);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #ffffff 60%, var(--bg-primary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            /* Reserve scrollbar space to prevent layout shift when modals lock/unlock scroll */
            scrollbar-gutter: stable both-edges;
        }

        /* Page scrollbar styling to match modal */
        html, body {
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--surface-light);
        }
        html::-webkit-scrollbar,
        body::-webkit-scrollbar {
            width: 10px;
        }
        html::-webkit-scrollbar-track,
        body::-webkit-scrollbar-track {
            background: var(--surface-light);
        }
        html::-webkit-scrollbar-thumb,
        body::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 8px;
            border: 2px solid var(--surface-light);
        }
        /* Lock background scroll when modal is open */
        body.modal-open { overflow: hidden; }

        /* Removed heavy fixed gradient layer to avoid full-viewport repaints on scroll */

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 20%;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .logo {
            width: 100px;
            height: 100px;
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 60px var(--glow);
            animation: float 3s ease-in-out infinite;
            /* Hint compositing to keep animation smooth */
            will-change: transform;
            transform: translateZ(0);
            position: relative;
            border: 2px solid var(--border); /* add depth without changing color */
            border-radius: 24px;
            /* emboss edges similar to block (neutral tones only) */
            box-shadow:
                inset 0 2px 0 rgba(255,255,255,0.15),
                inset 0 -3px 0 rgba(0,0,0,0.12),
                0 6px 0 rgba(0,0,0,0.12),
                0 20px 60px var(--glow);
        }

        .logo::before {
            content: '';
            position: absolute;
            inset: -2px;
            /* Replace heavy blur with a radial glow and soft halo */
            background: radial-gradient(closest-side, var(--primary) 0%, rgba(8, 164, 213, 0.45) 35%, transparent 70%);
            border-radius: 24px;
            z-index: -1;
            opacity: 0.6;
            box-shadow: 0 0 60px rgba(8, 164, 213, 0.25);
        }
        .logo img { box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); }

        h1 {
            font-size: 3rem;
            font-weight: 800;
            margin: 0 auto 0.5rem auto;
            letter-spacing: -0.02em;
            position: relative;
            padding: 0.75rem 2rem;
            border-radius: 16px;
            border: 3px solid rgba(0,0,0,0.22);
            background:
                linear-gradient(180deg, rgba(255,255,255,0.15) 0%, rgba(0,0,0,0.08) 100%),
                linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            /* 3D beveled effect matching buttons */
            box-shadow:
                inset 0 3px 0 rgba(255,255,255,0.45),
                inset 0 -4px 0 rgba(0,0,0,0.3),
                0 8px 0 rgba(0,0,0,0.25),
                0 12px 40px var(--glow),
                0 0 60px rgba(8, 164, 213, 0.3);
            color: white;
            text-shadow:
                0 2px 4px rgba(0,0,0,0.4),
                0 4px 12px rgba(0,0,0,0.2),
                0 -1px 2px rgba(255,255,255,0.3);
            transform-style: preserve-3d;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            animation: titlePulse 3s ease-in-out infinite;
            width: fit-content;
            overflow: hidden;
        }

        /* Epic animated shimmer overlay */
        h1::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                transparent 0%,
                transparent 40%,
                rgba(255,255,255,0.4) 50%,
                transparent 60%,
                transparent 100%
            );
            border-radius: 16px;
            opacity: 0;
            animation: shimmer 4s ease-in-out infinite;
            pointer-events: none;
            overflow: hidden;
        }


        /* Hover effect for interactivity */
        h1:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow:
                inset 0 3px 0 rgba(255,255,255,0.5),
                inset 0 -4px 0 rgba(0,0,0,0.3),
                0 10px 0 rgba(0,0,0,0.25),
                0 16px 48px var(--glow),
                0 0 80px rgba(8, 164, 213, 0.5);
        }

        /* Pulsing glow animation */
        @keyframes titlePulse {
            0%, 100% {
                box-shadow:
                    inset 0 3px 0 rgba(255,255,255,0.45),
                    inset 0 -4px 0 rgba(0,0,0,0.3),
                    0 8px 0 rgba(0,0,0,0.25),
                    0 12px 40px var(--glow),
                    0 0 60px rgba(8, 164, 213, 0.3);
            }
            50% {
                box-shadow:
                    inset 0 3px 0 rgba(255,255,255,0.45),
                    inset 0 -4px 0 rgba(0,0,0,0.3),
                    0 8px 0 rgba(0,0,0,0.25),
                    0 12px 40px var(--glow),
                    0 0 80px rgba(8, 164, 213, 0.5);
            }
        }

        /* Shimmer animation */
        @keyframes shimmer {
            0% {
                transform: translateX(-100%) skewX(-15deg);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateX(200%) skewX(-15deg);
                opacity: 0;
            }
        }

        /* Dark mode adjustments for h1 */
        [data-theme="dark"] h1 {
            border-color: rgba(0,0,0,0.4);
            background:
                linear-gradient(180deg, rgba(255,255,255,0.12) 0%, rgba(0,0,0,0.15) 100%),
                linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            box-shadow:
                inset 0 3px 0 rgba(255,255,255,0.35),
                inset 0 -4px 0 rgba(0,0,0,0.5),
                0 8px 0 rgba(0,0,0,0.5),
                0 12px 40px var(--glow),
                0 0 60px rgba(8, 164, 213, 0.4);
        }

        [data-theme="dark"] h1:hover {
            box-shadow:
                inset 0 3px 0 rgba(255,255,255,0.4),
                inset 0 -4px 0 rgba(0,0,0,0.5),
                0 10px 0 rgba(0,0,0,0.5),
                0 16px 48px var(--glow),
                0 0 90px rgba(8, 164, 213, 0.6);
        }

        /* Blackhole mode - MAXIMUM DRAMA */
        [data-theme="true-dark"] h1 {
            border-color: rgba(8, 164, 213, 0.3);
            background:
                linear-gradient(180deg, rgba(255,255,255,0.08) 0%, rgba(0,0,0,0.4) 100%),
                linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            box-shadow:
                inset 0 3px 0 rgba(255,255,255,0.25),
                inset 0 -4px 0 rgba(0,0,0,0.8),
                0 8px 0 rgba(0,0,0,0.9),
                0 12px 40px var(--glow),
                0 0 80px rgba(8, 164, 213, 0.6),
                0 0 120px rgba(51, 185, 225, 0.3);
            text-shadow:
                0 2px 4px rgba(0,0,0,0.8),
                0 4px 12px rgba(8, 164, 213, 0.4),
                0 -1px 2px rgba(255,255,255,0.2);
        }

        [data-theme="true-dark"] h1:hover {
            box-shadow:
                inset 0 3px 0 rgba(255,255,255,0.3),
                inset 0 -4px 0 rgba(0,0,0,0.8),
                0 10px 0 rgba(0,0,0,0.9),
                0 16px 48px var(--glow),
                0 0 100px rgba(8, 164, 213, 0.8),
                0 0 150px rgba(51, 185, 225, 0.4);
        }

        [data-theme="true-dark"] h1::before {
            background: linear-gradient(
                135deg,
                transparent 0%,
                transparent 40%,
                rgba(8, 164, 213, 0.6) 50%,
                transparent 60%,
                transparent 100%
            );
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.125rem;
            font-weight: 600;
            display: inline-block;
            padding: 0.45rem 0.85rem;
            margin: 0;
            border: 2px solid var(--border);
            border-radius: 12px;
            position: relative;
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(0,0,0,0.03) 100%);
            box-shadow:
                inset 0 2px 0 rgba(255,255,255,0.15),
                inset 0 -3px 0 rgba(0,0,0,0.12),
                0 4px 0 rgba(0,0,0,0.10);
            text-shadow: 0 1px 0 rgba(255,255,255,0.25);
        }

        /* Card System */
        .card {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 8px 24px var(--shadow);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) backwards;
        }

        .card:hover {
            border-color: var(--primary);
            box-shadow: 0 12px 48px var(--glow);
            transform: translateY(-2px);
        }

        .card.collapsed .card-content {
            display: none;
        }

        .card.collapsed {
            padding: 1.5rem 2rem;
            cursor: pointer; /* Make entire collapsed card clickable */
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
            position: relative;
            z-index: 1;
        }

        .card-header * { cursor: inherit; }

        .card-title-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .card-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px var(--glow);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .card-badge {
            display: none;
            align-items: center;
            justify-content: center;
            min-width: 28px;
            height: 28px;
            padding: 0 0.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 14px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-left: 0.5rem;
            animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .collapse-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.25rem;
            margin-left: 0.5rem;
        }

        .collapse-btn:hover {
            background: rgba(8, 164, 213, 0.1);
            border-color: var(--primary);
        }

        .collapse-btn.collapsed::before {
            content: '▼';
        }

        .collapse-btn:not(.collapsed)::before {
            content: '▲';
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 56px;
            height: 32px;
            cursor: pointer;
        }

        .toggle-switch input {
            display: none;
        }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: var(--surface-light);
            border-radius: 32px;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border: 2px solid var(--border);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            left: 2px;
            top: 2px;
            background: var(--text-secondary);
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-color: var(--primary);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(24px);
            background: white;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .label-description {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 400;
            margin-top: 0.25rem;
        }

        input[type="text"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            font-family: inherit;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--glow);
            transform: translateY(-1px);
        }

        input.invalid,
        select.invalid {
            border-color: var(--danger);
            animation: shake 0.3s ease;
        }

        input.valid,
        select.valid {
            border-color: var(--success);
        }

        .field-error {
            color: var(--danger);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
            animation: fadeInUp 0.3s ease;
        }

        .field-error.show {
            display: block;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Password Toggle Eye Icon */
        .password-field-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .password-field-wrapper input[type="password"],
        .password-field-wrapper input[type="text"] {
            padding-right: 3rem;
        }

        /* Mask sensitive inputs without triggering browser password managers */
        .sensitive-input.masked {
            -webkit-text-security: disc;
            text-security: disc;
        }

        .password-toggle-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            user-select: none;
            z-index: 10;
        }

        .password-toggle-icon:hover {
            color: var(--primary);
            transform: translateY(-50%) scale(1.1);
        }

        /* Language Selector - Modern Chips */
        .language-search {
            position: relative;
            margin-bottom: 1rem;
        }

        .language-search input {
            padding-left: 2.5rem;
        }

        .language-search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        .selected-languages {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 42px;
            padding: 0.5rem;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .selected-languages:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--glow);
        }

        .selected-languages.empty::before {
            content: 'Click languages below to add...';
            color: var(--text-secondary);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            height: 26px;
        }

        .language-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            animation: chipIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .language-chip:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px var(--glow);
        }

        .language-chip .remove {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }

        .language-chip .remove:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.75rem;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: var(--surface);
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .language-grid::-webkit-scrollbar {
            width: 8px;
        }

        .language-grid::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 4px;
        }

        .language-grid::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .language-item {
            padding: 0.75rem 1rem;
            background: var(--surface-light);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            user-select: none;
        }

        .language-item:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--glow);
        }

        .language-item.selected {
            background: linear-gradient(135deg, rgba(8, 164, 213, 0.18) 0%, rgba(51, 185, 225, 0.18) 100%);
            border-color: var(--primary);
            color: var(--primary-dark);
        }

        .language-item.hidden {
            display: none;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 0.5rem 1rem;
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-btn:hover {
            border-color: var(--primary);
            color: var(--primary-dark);
            background: rgba(8, 164, 213, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: 2px solid rgba(0,0,0,0.22);
            box-shadow:
                inset 0 2px 0 rgba(255,255,255,0.35),
                inset 0 -3px 0 rgba(0,0,0,0.22),
                0 6px 0 rgba(0,0,0,0.22),
                0 8px 24px var(--glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px var(--glow);
        }

        .btn-secondary {
            background: var(--surface-light);
            color: var(--text-primary);
            border: 2px solid var(--border);
            box-shadow:
                inset 0 2px 0 rgba(255,255,255,0.35),
                inset 0 -3px 0 rgba(0,0,0,0.12),
                0 6px 0 rgba(0,0,0,0.12);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            background: rgba(8, 164, 213, 0.1);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Subtle rivets to echo the Mario block feel (do not change colors) */
        .btn::after {
            content: '';
            position: absolute;
            width: 5px; height: 5px;
            border-radius: 50%;
            top: 6px; left: 6px;
            background: rgba(0,0,0,0.18);
            box-shadow:
                calc(100% - 12px) 0 0 rgba(0,0,0,0.18),
                0 calc(100% - 12px) 0 rgba(255,255,255,0.35),
                calc(100% - 12px) calc(100% - 12px) 0 rgba(0,0,0,0.18);
            pointer-events: none;
        }
        /* Reduce prominence for secondary to keep its neutral color */
        .btn-secondary::after { background: rgba(0,0,0,0.12); box-shadow:
            calc(100% - 12px) 0 0 rgba(0,0,0,0.12),
            0 calc(100% - 12px) 0 rgba(255,255,255,0.25),
            calc(100% - 12px) calc(100% - 12px) 0 rgba(0,0,0,0.12);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.12);
            color: var(--danger);
            border: 2px solid var(--danger);
        }
        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.18);
            box-shadow: 0 10px 28px rgba(239, 68, 68, 0.25);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        /* Alert System */
        .alert {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
            max-width: 500px;
            z-index: 9999;
            animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 12px 48px var(--shadow);
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--danger);
            color: var(--danger);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.2);
            border: 2px solid var(--warning);
            color: var(--warning);
        }

        .alert-info {
            background: rgba(8, 164, 213, 0.12);
            border: 2px solid var(--primary);
            color: var(--primary-dark);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }

        .loading-overlay.show {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--surface-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Model Fetching Status */
        .model-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .model-status.fetching {
            color: var(--primary-light);
        }

        .model-status.success {
            color: var(--success);
        }

        .model-status.error {
            color: var(--danger);
        }

        .model-status .spinner-small {
            width: 16px;
            height: 16px;
            border: 2px solid var(--surface-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes chipIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Keyboard shortcuts hint */
        .keyboard-hint {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 0.875rem;
            color: var(--text-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 1000;
        }

        .keyboard-hint.show {
            opacity: 1;
        }

        .kbd {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.875rem;
            color: var(--primary-light);
            margin: 0 0.25rem;
        }

        /* Install URL Display */
        .install-url-box {
            margin-top: 1.5rem;
            display: none;
        }

        .install-url-box.show {
            display: block;
        }

        .install-url-box label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .install-url-box input {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: monospace;
            cursor: text;
        }

        .install-url-box input:focus {
            outline: none;
            box-shadow: 0 0 0 4px var(--glow);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 3rem 2rem;
            margin-top: 4rem;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .footer-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .footer-heart {
            color: var(--danger);
            animation: heartPulse 3s ease-in-out infinite;
            display: inline-block;
            text-shadow: 0 0 0 transparent;
            transition: all 0.3s ease;
        }

        .footer p {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        .footer a {
            color: var(--primary-light);
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .footer a:hover {
            color: var(--primary);
        }

        @keyframes heartPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.9;
                text-shadow: 0 0 0 transparent;
            }
            50% {
                transform: scale(1.08);
                opacity: 1;
                text-shadow: 0 0 12px rgba(239, 68, 68, 0.4);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            .card {
                padding: 1.5rem;
            }

            .card.collapsed {
                padding: 1rem 1.5rem;
            }

            .language-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                max-height: 300px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .alert {
                right: 1rem;
                left: 1rem;
                min-width: auto;
            }

            .keyboard-hint {
                display: none;
            }

            .selected-languages {
                max-height: 150px;
                overflow-y: auto;
            }
        }

        /* Reset bar */
        .reset-bar {
            margin: 0;
            padding: 1rem 1.25rem;
            border: 2px dashed var(--border);
            border-radius: 14px;
            background: var(--surface);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            width: 100%;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
        }
        .reset-bar .reset-text {
            color: var(--text-secondary);
            font-weight: 600;
        }
        .reset-btn {
            appearance: none;
            border: 2px solid var(--danger);
            background: transparent;
            color: var(--danger);
            padding: 0.625rem 1rem;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease;
        }
        .reset-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 28px var(--shadow);
            background: rgba(239, 68, 68, 0.08);
        }
        .reset-btn:active { transform: translateY(0); }

        /* (JS positions reset bar vertically in the gap) */

        /* Disabled file translation option */
        #fileTranslationEnabled:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        #fileTranslationEnabled:disabled + span {
            color: var(--text-secondary);
        }

        /* Ghost Hint (Easter Egg) — minimal, delicate */
        .ghost-hint {
            position: fixed;
            left: 50%; /* JS will reposition near heart */
            top: 60%;
            transform: translateX(-50%) translateY(6px);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.05rem; /* closer to the arrow */
            opacity: 0;
            pointer-events: none; /* only inner CTA is clickable */
            z-index: 1200;
            transition: opacity 0.45s ease, transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .ghost-hint.show {
            opacity: 0.75; /* much more visible */
            transform: translateX(-50%) translateY(0);
        }

        .ghost-hint .ghost-cta {
            pointer-events: auto;
            background: transparent;
            border: none;
            color: #000000; /* light mode: black for readability */
            mix-blend-mode: normal;
            padding: 0.05rem 0.25rem; /* even tighter */
            border-radius: 6px;
            font-size: 12px; /* +2px bigger */
            line-height: 1; /* reduce vertical footprint */
            font-family: 'Tiny5', 'Silkscreen', 'VT323', 'Press Start 2P', 'Courier New', monospace; /* retro, less wide */
            font-weight: 400; /* lighter to reduce blur */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            letter-spacing: 0; /* reduce wide spacing for retro font */
            text-transform: none;
            cursor: pointer;
            user-select: none;
            transition: transform 0.15s ease, opacity 0.2s ease;
            animation: ghostFloat 3.2s ease-in-out infinite;
        }

        .ghost-hint .ghost-cta:hover {
            transform: translateY(-1px);
            opacity: 0.6;
        }

        .ghost-hint .ghost-arrow {
            font-size: 0.95rem;
            line-height: 1;
            color: #000000; /* light mode: black */
            animation: arrowPulse 1.6s ease-in-out infinite;
        }

        @keyframes ghostFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-2px); }
        }

        @keyframes arrowPulse {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(2px); }
        }

        label:has(#fileTranslationEnabled:disabled) {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Stagger animations */
        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }
        .card:nth-child(5) { animation-delay: 0.5s; }

        /* Modal System */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        /* Fly-out animation for instructions modal */
        .modal-overlay.fly-out {
            animation: fadeOut 0.52s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            pointer-events: none;
        }
        .modal-overlay.fly-out .modal {
            animation: flyToCorner 0.52s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            transform-origin: center center;
        }

        .modal {
            background:
                linear-gradient(180deg, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.75) 100%),
                var(--bg-secondary);
            border-radius: 20px;
            max-width: 640px;
            width: 92%;
            max-height: 85vh;
            /* Clip scrollbars within rounded corners */
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: 0 24px 72px var(--shadow), 0 0 0 1px rgba(8, 164, 213, 0.14);
            animation: modalSlideIn 0.42s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(8, 164, 213, 0.08) 0%, rgba(51, 185, 225, 0.08) 100%);
            position: sticky;
            top: 0;
            z-index: 1;
        }

        /* Legacy instructions-fab removed; map show/hide to .help-button */
        .help-button { opacity: 1; }
        .help-button.show { opacity: 1; }

        /* Animations for overlay fade and fly trajectory */
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        @keyframes flyToCorner {
            0%   { transform: translate(0, 0) scale(1);    opacity: 1; }
            60%  { transform: translate(calc(28vw - 28px), calc(26vh)) scale(0.55); opacity: 0.98; }
            100% { transform: translate(calc(40vw - 40px), calc(40vh)) scale(0.2); opacity: 0.95; }
        }
        /* Removed pulsing shadow animation for smoother scrolling */

        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* (modal-header emboss reverted to original) */

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 36px;
            height: 36px;
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.25rem;
            color: var(--text-secondary);
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--danger);
            color: var(--danger);
            transform: rotate(90deg);
        }

        .modal-content {
            padding: 1.5rem;
            text-align: center;
            /* Make only content area scrollable */
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1 1 auto;
            /* Keep layout centered even when scrollbar appears */
            scrollbar-gutter: stable both-edges;
        }

        .modal-content h3 {
            color: var(--primary-light);
            font-size: 1.125rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .modal-content h3:first-child {
            margin-top: 0;
        }

        .modal-content ol {
            margin: 0.75rem auto;
            padding-left: 1.5rem;
            color: var(--text-primary);
            line-height: 1.8;
            text-align: left;
            max-width: fit-content;
        }

        .modal-content li {
            margin: 0.5rem 0;
            color: var(--text-primary);
        }

        .modal-content p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin: 0.75rem 0;
        }

        .modal-content strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .modal-content em {
            color: var(--warning);
            font-style: normal;
            font-weight: 600;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            position: sticky;
            bottom: 0;
            background: var(--bg-secondary);
        }

        /* In-modal scrollbar styling (WebKit/Blink) */
        .modal-content::-webkit-scrollbar {
            width: 10px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: var(--surface-light);
            border-radius: 12px;
            /* Keep track inset from header/footer to avoid visual bleed */
            margin: 8px;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 8px;
            border: 2px solid var(--surface-light);
        }
        /* Firefox scrollbar styling */
        .modal-content {
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--surface-light);
        }

        .modal-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-right: auto;
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            user-select: none;
        }

        .modal-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .highlight-box {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .highlight-box p {
            color: var(--warning);
            font-weight: 600;
            margin: 0;
        }

        .info-box {
            background: rgba(8, 164, 213, 0.08);
            border: 1px solid rgba(8, 164, 213, 0.35);
            border-radius: 12px;
            padding: 0.9rem 1rem;
            margin: 1rem 0;
        }

        .info-box p {
            color: var(--text-secondary);
            font-weight: 500;
            margin: 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Scrollbar for modal */
        .modal::-webkit-scrollbar {
            width: 10px;
        }

        .modal::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 0 24px 24px 0;
        }

        .modal::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
        }

        .modal::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }

        .version-badge {
            display: inline-flex;
            align-items: center;
            font-size: 0.82rem;
            font-weight: 700;
            padding: 0.45rem 0.85rem;
            margin: 0;
            border-radius: 12px;
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(0,0,0,0.03) 100%);
            border: 2px solid var(--border);
            color: var(--text-secondary) !important;
            -webkit-text-fill-color: var(--text-secondary) !important;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            box-shadow:
                inset 0 2px 0 rgba(255, 255, 255, 0.15),
                inset 0 -3px 0 rgba(0, 0, 0, 0.12),
                0 4px 0 rgba(0, 0, 0, 0.10);
        }

        .version-badge::before {
            content: none;
        }

        .version-badge:hover {
            border-color: var(--primary);
            color: var(--text-primary) !important;
            -webkit-text-fill-color: var(--text-primary) !important;
            box-shadow:
                inset 0 2px 0 rgba(255, 255, 255, 0.15),
                inset 0 -3px 0 rgba(0, 0, 0, 0.12),
                0 4px 12px rgba(8, 164, 213, 0.18);
        }

        .version-badge:hover::before {
            content: none;
        }

        .version-badge-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
            margin-top: 0.5rem;
        }

        /* Prevent text selection on hero title, subtitle, and version badge */
        .header h1,
        .header .subtitle,
        .header .version-badge {
            user-select: none;
        }

        /* Validation Buttons */
        .validate-api-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: 2px solid rgba(0,0,0,0.22);
            border-radius: 10px;
            padding: 0.625rem 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.375rem;
            transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
            white-space: nowrap;
            box-shadow:
                inset 0 2px 0 rgba(255,255,255,0.35),
                inset 0 -3px 0 rgba(0,0,0,0.22),
                0 6px 0 rgba(0,0,0,0.18),
                0 2px 8px rgba(8, 164, 213, 0.25);
            min-width: 85px;
            justify-content: center;
            }

        .validate-api-btn::after {
            content: '';
            position: absolute;
            width: 4px; height: 4px; border-radius: 50%;
            top: 6px; left: 6px;
            background: rgba(0,0,0,0.18);
            box-shadow:
                calc(100% - 12px) 0 0 rgba(0,0,0,0.18),
                0 calc(100% - 12px) 0 rgba(255,255,255,0.35),
                calc(100% - 12px) calc(100% - 12px) 0 rgba(0,0,0,0.18);
            pointer-events: none;
        }

        .validate-api-btn:hover {
            transform: translateY(-2px);
            box-shadow:
                inset 0 2px 0 rgba(255,255,255,0.4),
                inset 0 -3px 0 rgba(0,0,0,0.22),
                0 6px 0 rgba(0,0,0,0.18),
                0 4px 16px rgba(8, 164, 213, 0.4);
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary) 100%);
        }

        .validate-api-btn:active {
            transform: translateY(0);
        }

        .validate-api-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .validate-api-btn.validating {
            background: linear-gradient(135deg, var(--text-secondary) 0%, #64748b 100%);
            pointer-events: none;
        }

        .validate-api-btn.validating .validate-icon {
            animation: spin 1s linear infinite;
        }

        .validate-api-btn.success {
            background: linear-gradient(135deg, var(--success) 0%, #34d399 100%);
        }

        .validate-api-btn.error {
            background: linear-gradient(135deg, var(--danger) 0%, #f87171 100%);
        }

        .validate-icon {
            font-size: 1rem;
            display: inline-block;
        }

        /* OpenSubtitles auth layout */
        .opensubs-auth-layout {
            display: grid;
            grid-template-columns: 1fr minmax(240px, 280px);
            gap: 1rem;
            align-items: stretch;
            margin-top: 0.5rem;
        }
        @media (max-width: 900px) {
            .opensubs-auth-layout {
                grid-template-columns: 1fr;
            }
        }
        .opensubs-auth-fields {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .validate-tile {
            position: relative;
            padding: 1rem;
            border-radius: 14px;
            border: 1px solid var(--border);
            background:
                linear-gradient(135deg, rgba(8, 164, 213, 0.12), rgba(51, 185, 225, 0.08)),
                var(--surface);
            box-shadow: 0 10px 32px var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            justify-content: center;
            align-self: stretch;
            overflow: hidden;
        }
        .validate-tile::before {
            content: '';
            position: absolute;
            inset: -40% auto auto -40%;
            width: 120%;
            height: 120%;
            background: radial-gradient(circle at center, rgba(8, 164, 213, 0.18), transparent 55%);
            opacity: 0.75;
            pointer-events: none;
            filter: blur(16px);
        }
        .validate-tile .tile-eyebrow {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-secondary);
        }
        .validate-tile .tile-title {
            font-weight: 800;
            font-size: 1.1rem;
            letter-spacing: -0.01em;
        }
        .validate-tile .tile-copy {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .validate-tile .validate-api-btn {
            width: 100%;
            justify-content: center;
        }

        

        .validation-feedback {
            margin-top: 0.5rem;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.875rem;
            display: none;
            animation: slideDown 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .validation-feedback.show {
            display: block;
        }

        .validation-feedback.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #059669;
        }

        .validation-feedback.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }

        .validation-feedback.info {
            background: rgba(8, 164, 213, 0.1);
            border: 1px solid rgba(8, 164, 213, 0.3);
            color: var(--primary-dark);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 2rem;
            right: 2rem;
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 9999;
            box-shadow: 0 4px 12px var(--shadow);
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        [data-theme="dark"] .theme-toggle {
            background: rgba(20, 25, 49, 0.9);
            border-color: var(--border);
        }

        .theme-toggle:focus,
        .theme-toggle:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(8, 164, 213, 0.35), 0 8px 20px var(--shadow);
        }

        .theme-toggle:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 20px var(--shadow);
            border-color: var(--primary);
        }

        .theme-toggle:active {
            transform: translateY(0) scale(0.98);
        }

        .theme-toggle-icon {
            font-size: 1.5rem;
            transition: all 0.3s ease;
            user-select: none;
            -webkit-user-drag: none;
            pointer-events: none;
        }

        .theme-toggle-icon.sun {
            display: block;
        }

        .theme-toggle-icon.moon {
            display: none;
        }

        .theme-toggle-icon.blackhole {
            display: none;
        }

        [data-theme="dark"] .theme-toggle-icon.sun {
            display: none;
        }

        [data-theme="dark"] .theme-toggle-icon.moon {
            display: block;
        }

        [data-theme="dark"] .theme-toggle-icon.blackhole {
            display: none;
        }

        [data-theme="true-dark"] .theme-toggle-icon.sun {
            display: none;
        }

        [data-theme="true-dark"] .theme-toggle-icon.moon {
            display: none;
        }

        [data-theme="true-dark"] .theme-toggle-icon.blackhole {
            display: block;
        }

        @media (max-width: 768px) {
            .theme-toggle {
                top: 1rem;
                right: 1rem;
                width: 42px;
                height: 42px;
            }

            .theme-toggle-icon {
                font-size: 1.25rem;
            }
        }
    </style>
    <style>
        /* Mario-style block + coin animation (perf-friendly: transforms only) */
        .theme-toggle.mario {
            background: linear-gradient(180deg, #f7d13e 0%, #e6b526 60%, #d49c1d 100%);
            border-color: #8a5a00;
            box-shadow:
                inset 0 2px 0 #fff3b0,
                inset 0 -3px 0 #b47a11,
                0 6px 0 #7a4d00,
                0 10px 16px rgba(0,0,0,0.35);
            position: fixed;
        }
        .theme-toggle.mario::before {
            content: '';
            position: absolute;
            width: 5px; height: 5px; border-radius: 50%;
            background: #b47a11;
            top: 6px; left: 6px;
            box-shadow:
                calc(100% - 12px) 0 0 #b47a11,
                0 calc(100% - 12px) 0 #b47a11,
                calc(100% - 12px) calc(100% - 12px) 0 #b47a11;
            opacity: .9;
        }
        .theme-toggle.mario:active { transform: translateY(2px) scale(0.98); box-shadow:
            inset 0 1px 0 #fff3b0,
            inset 0 -1px 0 #b47a11,
            0 4px 0 #7a4d00,
            0 8px 14px rgba(0,0,0,0.3);
        }
        .theme-toggle-icon { transition: transform 0.25s ease; display: grid; place-items: center; }
        .theme-toggle-icon svg {
            display: block;
            filter: drop-shadow(0 2px 0 rgba(0,0,0,0.2));
            pointer-events: none;
            user-select: none;
            -webkit-user-drag: none;
        }
        /* Coin effect */
        .coin { position: fixed; left: 0; top: 0; width: 22px; height: 22px; pointer-events: none; z-index: 10000; transform: translate(-50%, -50%); will-change: transform, opacity; contain: layout paint style; }
        .coin::before { content: ''; display: block; width: 100%; height: 100%; border-radius: 50%;
            background:
                linear-gradient(90deg, rgba(0,0,0,0) 45%, rgba(0,0,0,0.2) 55%) ,
                radial-gradient(40% 40% at 35% 30%, #fff6bf 0%, rgba(255,255,255,0) 70%),
                linear-gradient(180deg, #ffd24a 0%, #ffc125 50%, #e2a415 100%);
            border: 2px solid #8a5a00; box-shadow: 0 2px 0 #7a4d00, inset 0 1px 0 #fff8c6;
        }
        @keyframes coin-pop {
            0% { opacity: 0; transform: translate(-50%, -50%) translateY(0) scale(0.9) rotateY(0deg); }
            10% { opacity: 1; }
            60% { transform: translate(-50%, -50%) translateY(-52px) scale(1.0) rotateY(360deg); }
            100% { opacity: 0; transform: translate(-50%, -50%) translateY(-70px) scale(0.95) rotateY(540deg); }
        }
        .coin.animate { animation: coin-pop 0.7s cubic-bezier(.2,.8,.2,1) forwards; }
        @media (prefers-reduced-motion: reduce) { .coin.animate { animation: none; opacity: 0; } }

        /* Theme-based variants for Mario toggle */
        [data-theme="light"] .theme-toggle.mario {
            background: linear-gradient(180deg, #f7d13e 0%, #e6b526 60%, #d49c1d 100%);
            border-color: #8a5a00;
            box-shadow:
                inset 0 2px 0 #fff3b0,
                inset 0 -3px 0 #b47a11,
                0 6px 0 #7a4d00,
                0 10px 16px rgba(0,0,0,0.35);
        }
        [data-theme="light"] .theme-toggle.mario::before {
            background: #b47a11;
            box-shadow:
                calc(100% - 12px) 0 0 #b47a11,
                0 calc(100% - 12px) 0 #b47a11,
                calc(100% - 12px) calc(100% - 12px) 0 #b47a11;
        }

        [data-theme="dark"] .theme-toggle.mario {
            background: linear-gradient(180deg, #4c6fff 0%, #2f4ed1 60%, #1e2f8a 100%);
            border-color: #1b2a78;
            box-shadow:
                inset 0 2px 0 #b3c4ff,
                inset 0 -3px 0 #213a9a,
                0 6px 0 #16246a,
                0 10px 16px rgba(20,25,49,0.6);
        }
        [data-theme="dark"] .theme-toggle.mario::before {
            background: #213a9a;
            box-shadow:
                calc(100% - 12px) 0 0 #213a9a,
                0 calc(100% - 12px) 0 #213a9a,
                calc(100% - 12px) calc(100% - 12px) 0 #213a9a;
        }

        [data-theme="true-dark"] .theme-toggle.mario {
            background: linear-gradient(180deg, #1b1029 0%, #110b1a 60%, #0b0711 100%);
            border-color: #3b2a5d;
            box-shadow:
                inset 0 2px 0 #6b65ff33,
                inset 0 -3px 0 #2b2044,
                0 6px 0 #2a1e43,
                0 0 18px rgba(107,101,255,0.35);
        }
        [data-theme="true-dark"] .theme-toggle.mario::before {
            background: #2b2044;
            box-shadow:
                calc(100% - 12px) 0 0 #2b2044,
                0 calc(100% - 12px) 0 #2b2044,
                calc(100% - 12px) calc(100% - 12px) 0 #2b2044;
        }

        /* Mario-style section icons: same as toggle, slightly different (radius, rivets size) */
        .card-icon {
            position: relative;
            width: 50px; height: 50px;
            border: none;
            background: linear-gradient(180deg, #f7d13e 0%, #e6b526 60%, #d49c1d 100%);
            border-radius: 12px; /* chunkier block edges for the bigger icons */
            color: #3b2a00;
            text-shadow: none;
            box-shadow:
                inset 0 2px 0 #fff3b0,
                inset 0 -3px 0 #b47a11,
                0 6px 0 #7a4d00,
                0 10px 16px rgba(0,0,0,0.25);
            display: grid;
            place-items: center;
        }
        .card-icon svg {
            width: 34px;
            height: 34px;
            display: block;
        }
        .card-icon .card-icon-symbol {
            font-size: 1.6rem;
            line-height: 1;
            transform: translateY(0.5px);
        }
        .card-header:hover .card-icon { transform: translateY(-1px); }
        .card-icon::before {
            display: none;
        }
        [data-theme="dark"] .card-icon { 
            border: none; 
            background: linear-gradient(180deg, #4c6fff 0%, #2f4ed1 60%, #1e2f8a 100%);
            color: #0f1a4a;
            box-shadow:
                inset 0 2px 0 #b3c4ff,
                inset 0 -3px 0 #213a9a,
                0 6px 0 #16246a,
                0 10px 16px rgba(20,25,49,0.35);
        }
        [data-theme="dark"] .card-icon::before { display: none; }
        [data-theme="true-dark"] .card-icon {
            border: none;
            background: linear-gradient(180deg, #1b1029 0%, #110b1a 60%, #0b0711 100%);
            color: #bdb4ff;
            box-shadow:
                inset 0 2px 0 #6b65ff33,
                inset 0 -3px 0 #2b2044,
                0 6px 0 #2a1e43,
                0 0 18px rgba(107,101,255,0.25);
        }
        [data-theme="true-dark"] .card-icon::before { display: none; }

        /* Help button — match toggle style, slightly different (radius, rivets) */
        .help-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .help-button:hover { transform: translateY(-2px); }
        .help-button.mario {
            border: 2px solid #8a5a00;
            background: linear-gradient(180deg, #f7d13e 0%, #e6b526 60%, #d49c1d 100%);
            color: #3b2a00;
            border-radius: 14px; /* slight diff vs toggle */
            box-shadow:
                inset 0 2px 0 #fff3b0,
                inset 0 -3px 0 #b47a11,
                0 6px 0 #7a4d00,
                0 10px 16px rgba(0,0,0,0.35);
            text-shadow: 0 1px 0 rgba(255,255,255,0.6);
            position: fixed;
        }
        .help-button.mario::before {
            content: '';
            position: absolute;
            width: 5px; height: 5px; border-radius: 50%; opacity: .9;
            background: #b47a11; top: 6px; left: 6px;
            box-shadow: calc(100% - 12px) 0 0 #b47a11;
        }
        [data-theme="dark"] .help-button.mario {
            border-color: #1b2a78;
            background: linear-gradient(180deg, #4c6fff 0%, #2f4ed1 60%, #1e2f8a 100%);
            color: #0f1a4a;
            box-shadow:
                inset 0 2px 0 #b3c4ff,
                inset 0 -3px 0 #213a9a,
                0 6px 0 #16246a,
                0 10px 16px rgba(20,25,49,0.6);
        }
        [data-theme="dark"] .help-button.mario::before { background: #213a9a; box-shadow: calc(100% - 12px) 0 0 #213a9a; }
        [data-theme="true-dark"] .help-button.mario {
            border-color: #3b2a5d;
            background: linear-gradient(180deg, #1b1029 0%, #110b1a 60%, #0b0711 100%);
            color: #bdb4ff;
            box-shadow:
                inset 0 2px 0 #6b65ff33,
                inset 0 -3px 0 #2b2044,
                0 6px 0 #2a1e43,
                0 0 18px rgba(107,101,255,0.35);
        }
        [data-theme="true-dark"] .help-button.mario::before { background: #2b2044; box-shadow: calc(100% - 12px) 0 0 #2b2044; }
    </style>
</head>
<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle mario" id="themeToggle" aria-label="Toggle theme">
        <span class="theme-toggle-icon sun" aria-hidden="true">
            <svg viewBox="0 0 64 64" width="28" height="28" role="img">
                <defs>
                    <radialGradient id="gSun" cx="50%" cy="50%" r="60%">
                        <stop offset="0%" stop-color="#fff4b0"/>
                        <stop offset="60%" stop-color="#f7d13e"/>
                        <stop offset="100%" stop-color="#e0a81e"/>
                    </radialGradient>
                </defs>
                <g fill="none" stroke="#8a5a00" stroke-linecap="round">
                    <circle cx="32" cy="32" r="13" fill="url(#gSun)" stroke-width="3"/>
                    <g stroke-width="3">
                        <line x1="32" y1="6" x2="32" y2="14"/>
                        <line x1="32" y1="50" x2="32" y2="58"/>
                        <line x1="6" y1="32" x2="14" y2="32"/>
                        <line x1="50" y1="32" x2="58" y2="32"/>
                        <line x1="13" y1="13" x2="19" y2="19"/>
                        <line x1="45" y1="45" x2="51" y2="51"/>
                        <line x1="13" y1="51" x2="19" y2="45"/>
                        <line x1="45" y1="19" x2="51" y2="13"/>
                    </g>
                </g>
            </svg>
        </span>
        <span class="theme-toggle-icon moon" aria-hidden="true">
            <svg viewBox="0 0 64 64" width="28" height="28" role="img">
                <defs>
                    <radialGradient id="gMoon" cx="40%" cy="35%" r="65%">
                        <stop offset="0%" stop-color="#fff7cc"/>
                        <stop offset="70%" stop-color="#f1c93b"/>
                        <stop offset="100%" stop-color="#d19b16"/>
                    </radialGradient>
                    <mask id="mMoon">
                        <rect width="100%" height="100%" fill="#ffffff"/>
                        <circle cx="44" cy="22" r="18" fill="#000000"/>
                    </mask>
                </defs>
                <g fill="none" stroke="#8a5a00">
                    <circle cx="32" cy="32" r="22" fill="url(#gMoon)" stroke-width="3" mask="url(#mMoon)"/>
                </g>
            </svg>
        </span>
        <span class="theme-toggle-icon blackhole" aria-hidden="true">
            <svg viewBox="0 0 64 64" width="28" height="28" role="img">
                <defs>
                    <radialGradient id="gRing" cx="50%" cy="50%" r="50%">
                        <stop offset="0%" stop-color="#6b65ff"/>
                        <stop offset="60%" stop-color="#4b2ed6"/>
                        <stop offset="100%" stop-color="#1a103a"/>
                    </radialGradient>
                </defs>
                <circle cx="32" cy="32" r="12" fill="#000"/>
                <circle cx="32" cy="32" r="20" fill="none" stroke="url(#gRing)" stroke-width="6"/>
            </svg>
        </span>
    </button>

    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="logo.png" alt="SubMaker Logo" style="width: 80px; height: 80px; border-radius: 20px;">
            </div>
            <h1>SubMaker</h1>
            <div class="version-badge-wrapper">
                <p class="subtitle">AI-Powered Subtitle Translation</p>
                <span id="version-badge" class="version-badge" style="display:none;"></span>
            </div>
        </div>


        <div id="alertContainer"></div>

        <!-- Floating Help Button (Config page) -->
        <button class="help-button mario" id="configHelp" title="Help">?</button>

        <script>
        (function(){
            try {
                fetch('/api/session-stats', { cache: 'no-store' })
                    .then(function(r){ return r.ok ? r.json() : null; })
                    .then(function(d){
                        if (!d || !d.version) return;

                        // Show version badge
                        var el = document.getElementById('version-badge');
                        if (el) { el.textContent = 'v' + d.version; el.style.display = 'inline-flex'; }
                        // Optionally cache-bust logo image
                        var logo = document.querySelector('.logo img');
                        if (logo && logo.src && logo.src.indexOf('?v=') === -1) {
                            logo.src = logo.src + (logo.src.indexOf('?') === -1 ? '?v=' : '&v=') + d.version;
                        }
                    })
                    .catch(function(){});
            } catch (_) {}
        })();
        </script>

        <form id="configForm" autocomplete="off" spellcheck="false">
            <!-- No Translation Mode Toggle -->
            <div style="margin: 2rem 0; padding: 1.5rem; background: var(--surface-light); border: 2px solid var(--border); border-radius: 12px; display: flex; align-items: center; gap: 1rem;">
                <span style="font-size: 1.75rem;">⏸️</span>
                <div style="flex: 1;">
                    <span style="display: block; font-weight: 600; color: var(--text-primary);">Just Fetch Subtitles (No Translation)</span>
                    <span style="display: block; font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">Skip AI translation and just fetch subtitles in your chosen languages</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="noTranslationMode">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <!-- Subtitle API Providers -->
            <div class="card collapsed" data-card="subtitle-api">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon" aria-hidden="true">
                            <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                                <g fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="14" width="14" height="12" rx="2.5" ry="2.5" />
                                    <path d="M12 14v-2a4 4 0 0 1 8 0v2" />
                                    <circle cx="16" cy="20" r="2" />
                                    <path d="M16 22v2" />
                                </g>
                            </svg>
                        </div>
                        <h2 class="card-title">Subtitles API Keys</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="subtitle-api"></button>
                </div>
<div class="card-content">
                                        <!-- OpenSubtitles -->
                    <div class="form-group" style="padding-bottom: 1.5rem; border-bottom: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <label style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">📄</span>
                                <div>
                                    <strong style="display: block;">OpenSubtitles</strong>
                                    <span class="label-description" style="margin: 0;">Choose your preferred OpenSubtitles implementation below.</span>
                                </div>
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableOpenSubtitles" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="opensubtitlesConfig">
                            <!-- Implementation Type Selection -->
                            <div style="margin-bottom: 1rem; padding: 1rem; background: var(--surface-light); border-radius: 8px;">
                                <label style="display: block; margin-bottom: 0.75rem; font-weight: 600;">Implementation Type</label>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <label style="display: flex; align-items: start; gap: 0.5rem; cursor: pointer; padding: 0.75rem; background: white; border: 2px solid var(--border); border-radius: 8px; transition: all 0.2s;">
                                        <input type="radio" name="opensubtitlesImplementation" id="opensubtitlesImplV3" value="v3" checked style="margin-top: 0.25rem;">
                                        <div style="flex: 1;">
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <strong style="margin-bottom: 0.25rem;">V3 (Default)</strong>
                                                <div class="v3-warning-tooltip" style="position: relative; display: inline-flex; align-items: center;">
                                                    <span class="warning-icon" style="font-size: 1rem; color: var(--warning); cursor: help; animation: pulse 2s ease-in-out infinite;">⚠️</span>
                                                    <div class="tooltip-content" style="position: absolute; left: 100%; top: 50%; transform: translateY(-50%); margin-left: 0.5rem; background: rgba(245, 158, 11, 0.95); color: white; padding: 0.5rem 0.75rem; border-radius: 6px; font-size: 0.8rem; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                                                        V3 doesn't show all OpenSubtitles results and is slower than Auth.
                                                        <div style="position: absolute; right: 100%; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-top: 5px solid transparent; border-bottom: 5px solid transparent; border-right: 5px solid rgba(245, 158, 11, 0.95);"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <span class="label-description" style="margin: 0; font-size: 0.875rem;">Uses the official Stremio OpenSubtitles V3 addon. No authentication required, simple setup.</span>
                                        </div>
                                    </label>
                                    <style>
                                        @keyframes pulse {
                                            0%, 100% { transform: scale(1); opacity: 1; }
                                            50% { transform: scale(1.2); opacity: 0.8; }
                                        }
                                        .v3-warning-tooltip:hover .tooltip-content,
                                        .warning-icon:hover + .tooltip-content {
                                            opacity: 1 !important;
                                            pointer-events: auto !important;
                                        }
                                        .tooltip-content:hover {
                                            opacity: 1 !important;
                                            pointer-events: auto !important;
                                        }
                                    </style>
                                    <label style="display: flex; align-items: start; gap: 0.5rem; cursor: pointer; padding: 0.75rem; background: white; border: 2px solid var(--border); border-radius: 8px; transition: all 0.2s;">
                                        <input type="radio" name="opensubtitlesImplementation" id="opensubtitlesImplAuth" value="auth" style="margin-top: 0.25rem;">
                                        <div>
                                            <strong style="display: block; margin-bottom: 0.25rem;">Auth (Recommended)</strong>
                                            <span class="label-description" style="margin: 0; font-size: 0.875rem;">Uses your OpenSubtitles account with API key authentication. Requires username/password.</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Auth Configuration (shown when Auth is selected) -->
                            <div id="opensubtitlesAuthConfig" style="display: none;">
                                <div class="opensubs-auth-layout">
                                    <div class="opensubs-auth-fields">
                                        <label style="display: block;">Username</label>
                                        <input type="text" id="opensubtitlesUsername" placeholder="Enter OpenSubtitles Username" autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false">

                                        <label style="display: block;">Password</label>
                                        <div class="password-field-wrapper">
                                            <input type="text" class="sensitive-input masked" id="opensubtitlesPassword" placeholder="Enter OpenSubtitles Password" autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false" inputmode="text">
                                            <span class="password-toggle-icon" id="toggleOpenSubsPassword" title="Show/hide password">&#128274;&#128065;</span>
                                        </div>

                                        <span class="label-description"><a href="https://www.opensubtitles.com/en/newuser" target="_blank" style="color: var(--primary-light);">Create a free account</a> if you don't have one.</span>
                                    </div>

                                    <div class="validate-tile">
                                        <div class="tile-eyebrow" style="text-align:center;">Run a quick ping before saving to validate your credentials.</div>
                                        <button type="button" class="validate-api-btn" id="validateOpenSubtitles" title="Validate OpenSubtitles credentials">
                                            <span class="validate-icon">&#10003;</span>
                                            <span class="validate-text">Run Test</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="validation-feedback" id="opensubtitlesValidationFeedback"></div>
                            </div>
                        </div>
                    </div>

                    <!-- SubSource -->
                    <div class="form-group" style="padding: 1.5rem 0; border-bottom: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <label style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">🎬</span>
                                <div>
                                    <strong style="display: block;">SubSource</strong>
                                    <span class="label-description" style="margin: 0;">Get your free API key from <a href="https://subsource.net/" target="_blank" style="color: var(--primary-light);">SubSource.net</a></span>
                                </div>
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableSubSource" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="subsourceConfig">
                            <div style="display: flex; gap: 0.5rem; align-items: start;">
                                <input type="text" id="subsourceApiKey" placeholder="Enter SubSource API key" style="flex: 1;">
                                <button type="button" class="validate-api-btn" id="validateSubSource" title="Validate API key">
                                    <span class="validate-icon">✓</span>
                                    <span class="validate-text">Test</span>
                                </button>
                            </div>
                            <div class="validation-feedback" id="subsourceValidationFeedback"></div>
                        </div>
                    </div>

                    <!-- SubDL -->
                    <div class="form-group" style="padding: 1.5rem 0; border-bottom: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <label style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.5rem;">📋</span>
                                <div>
                                    <strong style="display: block;">SubDL</strong>
                                    <span class="label-description" style="margin: 0;">Get your free API key from <a href="https://subdl.com" target="_blank" style="color: var(--primary-light);">SubDL.com</a></span>
                                </div>
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableSubDL" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="subdlConfig">
                            <div style="display: flex; gap: 0.5rem; align-items: start;">
                                <input type="text" id="subdlApiKey" placeholder="Enter SubDL API key" style="flex: 1;">
                                <button type="button" class="validate-api-btn" id="validateSubDL" title="Validate API key">
                                    <span class="validate-icon">✓</span>
                                    <span class="validate-text">Test</span>
                                </button>
                            </div>
                            <div class="validation-feedback" id="subdlValidationFeedback"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- No-Translation Languages -->
            <div class="card collapsed" id="noTranslationCard" style="display: none;" data-card="notranslation">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon" aria-hidden="true">
                            <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                                <g fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="16" cy="16" r="10" />
                                    <path d="M16 6v20M6 16h20" />
                                    <path d="M10 10c2 4 4 6 6 6s4-2 6-6M10 22c2-4 4-6 6-6s4 2 6 6" />
                                </g>
                            </svg>
                        </div>
                        <h2 class="card-title">Languages</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="notranslation"></button>
                </div>
<div class="card-content">
                    <div class="form-group">
                        <label>
                            Subtitle Languages
                            <span class="label-description">Select which languages you want to fetch subtitles in.</span>
                        </label>

                        <div class="language-search">
                            <span class="language-search-icon">🔍</span>
                            <input type="text" id="noTranslationSearch" placeholder="Search languages...">
                        </div>

                        <div id="selectedNoTranslationLanguages" class="selected-languages empty"></div>

                        <div class="quick-actions">
                            <button type="button" class="quick-btn" data-action="select-popular-notranslation">⭐ Popular</button>
                            <button type="button" class="quick-btn" data-action="select-all-notranslation">✓ All</button>
                            <button type="button" class="quick-btn" data-action="clear-notranslation">✗ Clear</button>
                        </div>

                        <div id="noTranslationLanguages" class="language-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Gemini API -->
            <div class="card collapsed" id="geminiCard" data-card="gemini">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon" aria-hidden="true">
                            <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="16" cy="16" r="10.5" stroke-width="2.2" />
                                    <circle cx="16" cy="16" r="5" stroke-width="1.8" />
                                    <path d="M16 6v-2M22.5 8.2l1.4-1.4M26 15h2M22.5 23.8l1.4 1.4M16 26v2M9.5 23.8l-1.4 1.4M6 15H4M9.5 8.2 8.1 6.8" stroke-width="1.15" />
                                    <path d="M16 11v4.2l2.8 1.6" stroke-width="1.8" />
                                    <path d="M12.8 21.4c0.7 1 1.9 1.6 3.2 1.6s2.5-0.6 3.2-1.6" stroke-width="1.2" opacity="0.8" />
                                </g>
                            </svg>
                        </div>
                        <h2 class="card-title">AI Translation API Keys</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="gemini"></button>
                </div>
<div class="card-content">
                    <div class="form-group">
                        <label for="geminiApiKey">
                            Gemini API Key
                            <span class="label-description">Get your free API key from <a href="https://makersuite.google.com/app/apikey" target="_blank" style="color: var(--primary-light);">Google AI Studio</a>
                            <span class="gemini-help-tooltip" style="position: relative; display: inline-flex; align-items: center; margin-left: 0.4rem;">
                                <span class="help-icon" tabindex="0" aria-label="Gemini API setup help" style="display: inline-flex; width: 1rem; height: 1rem; font-size: 0.75rem; line-height: 1rem; align-items: center; justify-content: center; border: 1px solid var(--primary); border-radius: 50%; color: var(--primary); cursor: help; user-select: none;">?</span>
                                <div class="tooltip-content" style="position: absolute; left: 100%; top: 50%; transform: translateY(-50%); margin-left: 0.5rem; background: rgba(8, 164, 213, 0.98); color: #fff; padding: 0.6rem 0.75rem; border-radius: 8px; font-size: 0.85rem; width: 320px; max-width: 75vw; opacity: 0; pointer-events: none; transition: opacity 0.18s ease; z-index: 1000; box-shadow: 0 4px 14px rgba(0,0,0,0.18); text-wrap: balance;">
                                    <strong style="display:block; margin-bottom: 0.35rem;">Gemini Instructions:</strong>
                                    <ol style="padding-left: 1.05rem; display:block;">
                                        <li style="margin: 0.2rem 0;">Go to <a href="https://aistudio.google.com/app/api-keys" target="_blank" style="color:#fff; text-decoration: underline;">aistudio.google.com/app/api-keys</a></li>
                                        <li style="margin: 0.2rem 0;">Click "Create API Key"</li>
                                        <li style="margin: 0.2rem 0;">Name it anything</li>
                                        <li style="margin: 0.2rem 0;">Select a Project → Create Project → Name it → Create</li>
                                        <li style="margin: 0.2rem 0;">Create the API key</li>
                                        <li style="margin: 0.2rem 0;">Copy your API key and paste it below</li>
                                    </ol>
                                    <div style="position: absolute; right: 100%; top: 50%; transform: translateY(-50%); width: 0; height: 0; border-top: 6px solid transparent; border-bottom: 6px solid transparent; border-right: 6px solid rgba(8, 164, 213, 0.98);"></div>
                                </div>
                                <script>
                                    (function(){
                                        try {
                                            const container = document.currentScript && document.currentScript.previousElementSibling ? document.currentScript.previousElementSibling : null;
                                            // previousElementSibling is the tooltip-content; parentElement is .gemini-help-tooltip
                                            const wrap = container ? container.parentElement : null;
                                            const icon = wrap ? wrap.querySelector('.help-icon') : null;
                                            const show = () => { const t = wrap && wrap.querySelector('.tooltip-content'); if (t) { t.style.opacity = '1'; t.style.pointerEvents = 'auto'; } };
                                            const hide = () => { const t = wrap && wrap.querySelector('.tooltip-content'); if (t) { t.style.opacity = '0'; t.style.pointerEvents = 'none'; } };
                                            if (wrap && icon) {
                                                wrap.addEventListener('mouseenter', show);
                                                wrap.addEventListener('mouseleave', hide);
                                                icon.addEventListener('focus', show);
                                                icon.addEventListener('blur', hide);
                                                icon.addEventListener('click', function(e){
                                                    e.stopPropagation();
                                                    const t = wrap.querySelector('.tooltip-content');
                                                    if (!t) return;
                                                    const visible = t.style.opacity === '1';
                                                    if (visible) { hide(); } else { show(); }
                                                });
                                                document.addEventListener('click', function(){ hide(); });
                                            }
                                        } catch (e) { /* no-op */ }
                                    })();
                                </script>
                            </span></span>
                        </label>
                        <div style="display: flex; gap: 0.5rem; align-items: start;">
                            <input type="text" class="sensitive-input masked" id="geminiApiKey" placeholder="Enter your Gemini API key" style="flex: 1;" autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false" inputmode="text">
                            <button type="button" class="validate-api-btn" id="validateGemini" title="Validate API key">
                                <span class="validate-icon">✓</span>
                                <span class="validate-text">Test</span>
                            </button>
                        </div>
                        <div class="validation-feedback" id="geminiValidationFeedback"></div>
                        <div class="field-error" id="geminiApiKeyError">API key is required</div>
                    </div>

                    <div class="form-group">
                        <label for="geminiModel">
                            Translation Model
                            <span class="label-description">AI model for translations</span>
                        </label>
                        <select id="geminiModel" required>
                            <option value="gemini-2.5-flash-lite-preview-09-2025">Gemini 2.5 Flash-Lite</option>
                            <option value="gemini-2.5-flash-preview-09-2025" selected>Gemini 2.5 Flash</option>
                            <option value="gemini-2.5-pro">Gemini 2.5 Pro (Slow)</option>
                        </select>
                        <div class="field-error" id="geminiModelError">Please select a model</div>
                        <div style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);">
                            <strong style="margin-left: 2px;">Bad/broken or out-of-sync translation?</strong> Quickly triple-click the subtitle to force a re-translation.
                        </div>
                        <div style="margin-top: 0.6rem; padding: 0.75rem; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px; font-size: 0.875rem; color: var(--text-secondary);">
                            <strong style="color: var(--warning);">⚡ 2.5 Pro usage is still in Beta.</strong> If you have translation problems, use Flash-Lite.
                        </div>
                        <div id="proRateLimitWarning" style="display: none; margin-top: 0.75rem; padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; font-size: 0.875rem; color: var(--text-secondary);">
                            <strong style="color: #ef4444;">⚠️ Free Tier Limitation:</strong> If using a free API key, Gemini 2.5 Pro may trigger rate limits (HTTP 429). You'll likely only be able to translate one subtitle at a time.
                        </div>
                        <script>
                        (function() {
                            const modelSelect = document.getElementById('geminiModel');
                            const warningDiv = document.getElementById('proRateLimitWarning');
                            if (modelSelect && warningDiv) {
                                function updateWarning() {
                                    warningDiv.style.display = modelSelect.value === 'gemini-2.5-pro' ? 'block' : 'none';
                                }
                                modelSelect.addEventListener('change', updateWarning);
                                updateWarning(); // Initial check
                            }
                        })();
                        </script>
                    </div>

                    <div class="form-group" style="display: none;">
                        <label for="promptStyle">
                            Prompt Style
                            <span class="label-description">Choose between strict structure preservation or natural flow adaptation</span>
                        </label>
                        <select id="promptStyle">
                            <option value="natural" disabled title="Temporarily unavailable">Natural - Adapts structure for natural target language flow</option>
                            <option value="strict">Strict - Preserves exact timing and structure</option>
                        </select>
                    </div>

                    <!-- Advanced Settings removed by request -->
                </div>
            </div>

            <!-- Source Languages -->
            <div class="card collapsed" id="sourceCard" data-card="source">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon" aria-hidden="true">
                            <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                                <g fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="16" cy="11" r="4" />
                                    <path d="M10 18c0-2.5 2.7-4 6-4s6 1.5 6 4" />
                                    <path d="M8 23c-.5-1-1.5-2-3-2M24 23c.5-1 1.5-2 3-2" />
                                    <path d="M6 26h20" />
                                </g>
                            </svg>
                        </div>
                        <h2 class="card-title">Source Languages</h2>
                        <span class="card-badge" id="sourceBadge">0</span>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="source"></button>
                </div>
<div class="card-content">
                    <div class="form-group">
                        <label>
                            * Source languages for translations
                            <span class="label-description">You can select up to 3 source languages, but only 1 is recommended (so you have the same list order when translating). All subtitles from this language will be available for translation in the translation selector AND will be fetched (original subtitles will show up).</span>
                        </label>

                        <div class="language-search">
                            <span class="language-search-icon">🔍</span>
                            <input type="text" id="sourceSearch" placeholder="Search languages..." accesskey="s">
                        </div>

                        <div id="selectedSourceLanguages" class="selected-languages empty"></div>
                        <div class="field-error" id="sourceLanguagesError">Please select 1 source language</div>

                        <div id="sourceLanguages" class="language-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Target Languages -->
            <div class="card collapsed" id="targetCard" data-card="target">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon" aria-hidden="true">
                            <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                                <g fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="16" cy="16" r="10" />
                                    <circle cx="16" cy="16" r="6" />
                                    <circle cx="16" cy="16" r="2" fill="currentColor" />
                                    <path d="M16 6v4M16 22v4M6 16h4M22 16h4" />
                                </g>
                            </svg>
                        </div>
                        <h2 class="card-title">Target Languages</h2>
                        <span class="card-badge" id="targetBadge">0</span>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="target"></button>
                </div>
<div class="card-content">
                    <div class="form-group">
                        <label>
                            * Target languages for subtitles and translations
                            <span class="label-description">Subtitles in target languages will be fetched AND translation buttons will appear for translating FROM the source language TO these languages.</span>
                        </label>

                        <div class="language-search">
                            <span class="language-search-icon">🔍</span>
                            <input type="text" id="targetSearch" placeholder="Search languages..." accesskey="t">
                        </div>

                        <div id="selectedTargetLanguages" class="selected-languages empty"></div>
                        <div class="field-error" id="targetLanguagesError">Please select at least one target language</div>

                        <div class="quick-actions">
                            <button type="button" class="quick-btn" data-action="select-popular-target">⭐ Popular</button>
                            <button type="button" class="quick-btn" data-action="select-all-target">✓ All</button>
                            <button type="button" class="quick-btn" data-action="clear-target">✗ Clear</button>
                        </div>

                        <div id="targetLanguages" class="language-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Learn Target Languages -->
            <div class="card collapsed" id="learnTargetsCard" style="display: none;" data-card="learn">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon" aria-hidden="true">
                            <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                                <defs>
                                    <linearGradient id="learnAurora" x1="10%" y1="15%" x2="90%" y2="85%">
                                        <stop offset="0%" stop-color="currentColor" stop-opacity="0.15" />
                                        <stop offset="45%" stop-color="currentColor" stop-opacity="0.05" />
                                        <stop offset="100%" stop-color="currentColor" stop-opacity="0.18" />
                                    </linearGradient>
                                </defs>
                                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 12.6c1.5-2 4.8-3 8.2-1.8L16 12.8l1.8-2c3.4-1.2 6.7-0.2 8.2 1.8v11.7c-1.5-2-4.8-3-8.2-1.8L16 24.9l-1.8-2.4c-3.4-1.2-6.7-0.2-8.2 1.8V12.6z" stroke-width="2.2" fill="url(#learnAurora)" />
                                    <path d="M16 13v11.9" stroke-width="2.2" />
                                    <path d="M13 21.6l-3 2m9-2l3 2" stroke-width="1.1" opacity="0.5" />
                                    <path d="M16 5.9l1.1 1.5L16 7.8l-1.1-0.4z" fill="currentColor" />
                                    <path d="M16 6.9l0.5 1.3 1.3 0.3-1.1 0.8 0.1 1.3L16 9.8l-0.8 0.8 0.1-1.3-1.1-0.8 1.3-0.3z" fill="currentColor" opacity="0.9" />
                                </g>
                            </svg>
                        </div>
                        <h2 class="card-title">Learn Target Languages</h2>
                        <span class="card-badge" id="learnBadge">0</span>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="learn"></button>
                </div>
<div class="card-content">
                    <div class="form-group">
                        <label>
                            Select Learn Mode Languages
                            <span class="label-description">Creates "Learn (Language)" entries that pair source + translated lines in WebVTT.</span>
                        </label>

                        <div class="language-search">
                            <span class="language-search-icon">🔍</span>
                            <input type="text" id="learnSearch" placeholder="Search languages...">
                        </div>

                        <div id="selectedLearnLanguages" class="selected-languages empty"></div>
                        <div class="field-error" id="learnLanguagesError">Please select at least one learn language</div>

                        <div class="quick-actions">
                            <button type="button" class="quick-btn" data-action="select-popular-learn">⭐ Popular</button>
                            <button type="button" class="quick-btn" data-action="select-all-learn">✓ All</button>
                            <button type="button" class="quick-btn" data-action="clear-learn">✗ Clear</button>
                        </div>

                        <div id="learnLanguages" class="language-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Other Settings -->
            <div class="card collapsed" data-card="cache">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon" aria-hidden="true">
                            <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                                <g fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 9h8M18 9h8" />
                                    <circle cx="15" cy="9" r="2" fill="currentColor" />
                                    <path d="M6 16h8M18 16h8" />
                                    <circle cx="15" cy="16" r="2" fill="currentColor" />
                                    <path d="M6 23h4M14 23h12" />
                                    <circle cx="11" cy="23" r="2" fill="currentColor" />
                                </g>
                            </svg>
                        </div>
                        <h2 class="card-title">Other Settings</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="cache"></button>
                </div>
<div class="card-content">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="fileTranslationEnabled">
                            Enable "Translate SRT"
                            <span class="label-description">Show the "Translate SRT" option in the subtitles list to upload and translate subtitles files directly.</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="cacheEnabled" checked>
                            Enable SubMaker Database
                            <span class="label-description">Reads and caches translated subtitles from/to our database. Avoids re-translating already-translated subtitles. Reduces API usage and improves performance.</span>
                        </label>
                    </div>

                    <div class="form-group" id="bypassCacheGroup">
                        <label>
                            <input type="checkbox" id="bypassCache">
                            Bypass SubMaker Database Cache (Force Retranslation)
                            <span class="label-description">Skips reading our database cache and do not save translated subtitles to it. Translations will be stored in a temporary cache (for 12 hours).</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="learnModeEnabled">
                            Learn Mode
                            <span class="label-description">Adds "Learn (Language)" entries that output dual-language WebVTT with source and translated lines for language learning.</span>
                        </label>
                    </div>

                    <div class="form-group" id="learnOrderGroup" style="display: none;">
                        <label>
                            Learn Mode Subtitle Order
                            <span class="label-description">Choose which language appears at the top and bottom of the screen.</span>
                        </label>
                        <div class="option-group" style="display: flex; gap: 0.75rem; margin-top: 0.35rem;">
                            <label style="background: white; padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                <input type="radio" name="learnOrder" value="source-top" checked>
                                Source Top • Target Bottom
                            </label>
                            <label style="background: white; padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                <input type="radio" name="learnOrder" value="target-top">
                                Target Top • Source Bottom
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="mobileMode">
                            Mobile Mode (beta)
                            <span class="label-description">Holds translation requests and sends the final subtitle only when ready. Use this if you're watching on Android/iOS. No partial translations, no loading messages. Might freeze the stream until translation is ready. Flash-lite recommended. Wait 1-3 min, if it doesn't load automatically switch subtitles back and forth to load the translation.</span>
                        </label>
                    </div>

                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="card collapsed" data-card="advanced" id="advancedSettingsCard" style="display: none;">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon" aria-hidden="true">
                            <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                                <defs>
                                    <linearGradient id="advCore" x1="30%" y1="0%" x2="70%" y2="100%">
                                        <stop offset="0%" stop-color="currentColor" stop-opacity="0.18" />
                                        <stop offset="100%" stop-color="currentColor" stop-opacity="0.05" />
                                    </linearGradient>
                                </defs>
                                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="16" cy="16" r="10.5" stroke-width="2.2" />
                                    <path d="M16 4.5v2.5M16 25v2.5M7 9.5l2.2 1.3M22.8 21.2l2.2 1.3M7 22.5l2.2-1.3M22.8 10.8l2.2-1.3M4.5 16h2.6M24.9 16h2.6" stroke-width="1.4" />
                                    <path d="M16 7.2c2.3 1.7 3.8 4.6 3.1 7.8L16 27l-3.1-12c-0.7-3.2 0.8-6.1 3.1-7.8z" stroke-width="1.7" fill="url(#advCore)" />
                                    <path d="M13.3 15.6c-1.6 0.5-3 1.6-3 3.2 0 1 0.4 1.9 1.2 2.5" stroke-width="1.2" />
                                    <path d="M18.7 15.6c1.6 0.5 3 1.6 3 3.2 0 1-0.4 1.9-1.2 2.5" stroke-width="1.2" />
                                    <circle cx="16" cy="13.5" r="1.8" stroke-width="1.5" fill="currentColor" />
                                    <path d="M16 21.2l-2 2.5 2 1.4 2-1.4z" stroke-width="1.3" />
                                    <path d="M12 10.2c1-1.2 2.5-2.1 4-2.2" stroke-width="1.2" opacity="0.6" />
                                    <path d="M20 10.2c-1-1.2-2.5-2.1-4-2.2" stroke-width="1.2" opacity="0.6" />
                                </g>
                            </svg>
                        </div>
                        <h2 class="card-title">Advanced Settings (EXPERIMENTAL)</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="advanced"></button>
                </div>
<div class="card-content">
                    <div class="info-box" style="margin-bottom: 0.75rem;">
                        <p style="font-size: 0.95rem; margin: 0;">
                            <strong>Fine-tune AI behavior:</strong> Override default model and sampling parameters.
                        </p>
                    </div>
                    <div class="highlight-box" style="margin-bottom: 1.25rem;">
                        <p style="font-size: 0.9rem; margin: 0;">
                            When any setting is changed from defaults, <strong style="color: var(--warning);">Bypass Cache is automatically enabled</strong> to ensure your experimental translations don't pollute the shared database.
                        </p>
                    </div>

                    <div class="form-group">
                        <label for="advancedModel">
                            Translation Model Override
                            <span class="label-description">Override the default model. Leave empty to use system default (gemini-2.5-flash-lite-preview-09-2025).</span>
                        </label>
                        <select id="advancedModel">
                            <option value="">Use Default Model</option>
                        </select>
                        <div class="model-status" id="modelStatus"></div>
                    </div>

                    <div class="form-group">
                        <label for="advancedThinkingBudget">
                            Thinking Budget (Extended Reasoning)
                            <span class="label-description">0 = disabled, -1 = dynamic (auto-adjust), or fixed token count (1-32768). Higher values = deeper reasoning but slower.</span>
                        </label>
                        <input type="number" id="advancedThinkingBudget" min="-1" max="32768" step="1" value="0" placeholder="0">
                    </div>

                    <div class="form-group">
                        <label for="advancedTemperature">
                            Temperature (Creativity)
                            <span class="label-description">Controls randomness (0.0-2.0). Lower = more deterministic, Higher = more creative. Default: 0.8</span>
                        </label>
                        <input type="number" id="advancedTemperature" min="0" max="2" step="0.1" value="0.8" placeholder="0.8">
                    </div>

                    <div class="form-group">
                        <label for="advancedTopP">
                            Top-P (Nucleus Sampling)
                            <span class="label-description">Probability threshold (0.0-1.0). Lower = more focused, Higher = more diverse. Default: 0.95</span>
                        </label>
                        <input type="number" id="advancedTopP" min="0" max="1" step="0.05" value="0.95" placeholder="0.95">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enableBatchContext">
                            Enable Batch Context (Experimental)
                            <span class="label-description">Include original surrounding context and previous translations when processing batches. Improves translation coherence but may break outputs and increases token usage. Disabled by default.</span>
                        </label>
                    </div>

                    <div class="form-group" id="contextSizeGroup" style="display: none;">
                        <label for="contextSize">
                            Context Size
                            <span class="label-description">Number of surrounding entries to include as context (1-10). Default: 3</span>
                        </label>
                        <input type="number" id="contextSize" min="1" max="10" step="1" value="3" placeholder="3">
                    </div>
                </div>
            </div>

            <!-- Dev Settings (hidden until Ctrl+Alt+D) -->
            <div class="card collapsed" data-card="dev" id="devSettingsCard" style="display: none;">
                <div class="card-header">
                    <div class="card-title-group">
                        <div class="card-icon" aria-hidden="true">
                            <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                                <g fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 6l-8 10 8 10M20 6l8 10-8 10" />
                                    <path d="M19 4l-6 24" />
                                </g>
                            </svg>
                        </div>
                        <h2 class="card-title">Dev</h2>
                    </div>
                    <button type="button" class="collapse-btn collapsed" data-collapse="dev"></button>
                </div>
<div class="card-content">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="syncSubtitlesEnabled">
                            Enable "Sync Subtitles"
                            <span class="label-description">Show the "Sync Subtitles" option in the subtitles list to open the sync page for the current video.</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="btn-group">
                <button type="submit" class="btn btn-primary" accesskey="enter">
                    💾 Save Configuration
                </button>
                <button type="button" class="btn btn-secondary" id="installBtn" disabled>
                    🚀 Install in Stremio
                </button>
                <button type="button" class="btn btn-secondary" id="copyBtn" disabled>
                    📋 Copy Install URL
                </button>
            </div>

            <!-- Install URL Display -->
            <div class="install-url-box" id="installUrlBox">
                <label for="installUrlDisplay">Install URL</label>
                <input type="text" id="installUrlDisplay" readonly>
            </div>
        </form>

        <!-- Full Reset CTA (positioned vertically by JS) -->
        <div id="resetBarWrapper" class="reset-bar">
            <div class="reset-text">Any problems? Reset settings to default →</div>
            <button type="button" id="resetSettingsBtn" class="reset-btn">Reset</button>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>
                Made with <span class="footer-heart" id="secretHeart" style="cursor: pointer; user-select: none;">❤️</span> for Stremio users everywhere
            </p>
            <p style="font-size: 0.875rem;">
                Thank you for using SubMaker! Your support helps make content accessible to everyone.
            </p>
        </div>
    </footer>

    <!-- Ghost Hint (Easter Egg tooltip) -->
    <div class="ghost-hint" id="ghostHint" aria-hidden="true">
        <div class="ghost-cta" id="ghostHintBtn" title="Opens experimental settings">click here</div>
        <div class="ghost-arrow" aria-hidden="true">⬇</div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <div class="keyboard-hint" id="keyboardHint">
        Press <span class="kbd">?</span> for keyboard shortcuts
    </div>

    <!-- Old Instructions Mini-FAB removed; replaced by .help-button (configHelp) -->

    <!-- Main Instructions Modal -->
    <div class="modal-overlay" id="instructionsModal">
        <div class="modal">
            <div class="modal-header">
                <h2>ℹ️ How to Use SubMaker</h2>
                <div class="modal-close" id="closeInstructionsBtn">×</div>
            </div>
            <div class="modal-content">
                <h3>🚀 Usage Instructions:</h3>
                <ol>
                    <li>Add desired API keys to <strong>"Subtitles Sources"</strong> section.</li>
                    <li>Add a Gemini API Key to <strong>AI section</strong>.</li>
                    <li>Select <strong>source languages</strong>.</li>
                    <li>Select <strong>target languages</strong>.</li>
                    <li><strong>Install on Stremio</strong>.</li>
                </ol>

                <h3>🎬 Stremio will:</h3>
                <p>1. Fetch all Source and Target languages subtitles from sources.<br>
                2. Create <strong>"Make [Target Language]"</strong> buttons within the subtitles list.<br>
		3. All "Make" translation lists are in the same order of the Source language list.</p>

                <h3>⚡ When you click a subtitle:</h3>
                <p>When a subtitle is clicked within the "Make" translation lists, it'll start translation.<br>
		After 20-30 seconds, reload the same subtitle entry.<br>
                It'll load <strong>translated</strong>!</p>
                <div class="highlight-box" style="margin-top: 0.75rem; text-align: left;">
                    <strong>Quick Tip:</strong> If a translation looks off, broken, or out of sync, quickly triple-click that subtitle in the list to force a fresh re-translation.
                </div>

                <p style="margin-top: 0.75rem;">
		<b>PS:</b>
		Partial translation is delivered in batches so you can start watching almost instantly.<br>
                Complete translation may take from <strong>30 seconds-5 minutes</strong> depending on movie/episode length.</p>

                <div class="highlight-box">
                    <p><em>*Only 1 source language recommended:*</em></p>
                    <p style="color: var(--text-secondary); font-weight: normal; margin-top: 0.5rem;">When the "Make" translation lists are created, they load the subtitles list in the same order of the source language.<br>That means you can test the source language subtitles for the correct sync and only then select the same one on the translation list instead of translating unsync'd subtitles.</p>
                </div>	
            </div>
            <div class="modal-footer">
                <label class="modal-checkbox">
                    <input type="checkbox" id="dontShowInstructions">
                    Don't show this again
                </label>
                <button type="button" class="btn btn-primary" id="gotItInstructionsBtn">
                    Got it!
                </button>
            </div>
        </div>
    </div>

    <!-- Translate SRT Instructions Modal -->
    <div class="modal-overlay" id="fileTranslationModal">
        <div class="modal">
            <div class="modal-header">
                <h2>📁 Translate SRT Instructions</h2>
                <div class="modal-close" id="closeFileTranslationBtn">×</div>
            </div>
            <div class="modal-content">
                <h3>📤 How to Use "Translate SRT":</h3>
                <ol>
                    <li>Enable it on the config page before installing.</li>
                    <li>Click <strong>"Translate SRT"</strong> in the subtitles list when streaming.</li>
                    <li>Right-click the stream or select the three-dots menu and click <strong>"Download Subtitles"</strong></li>
                    <li>A webpage will open on your browser.</li>
                    <li>Upload the .srt file you'd like to translate. It will use your Gemini API key.</li>
                    <li>When it's done, download the translated subtitles and drag it to Stremio.</li>
                </ol>
            </div>
            <div class="modal-footer">
                <label class="modal-checkbox">
                    <input type="checkbox" id="dontShowFileTranslation">
                    Don't show this again
                </label>
                <button type="button" class="btn btn-primary" id="gotItFileTranslationBtn">
                    Got it!
                </button>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal-overlay" id="resetConfirmModal">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="resetConfirmTitle">
            <div class="modal-header">
                <h2 id="resetConfirmTitle">🧹 Reset All Settings</h2>
                <div class="modal-close" id="closeResetConfirmBtn">×</div>
            </div>
            <div class="modal-content">
                <p><strong>This will reset literally everything for this site:</strong></p>
                <p>- Local storage, session storage, cached config and tokens</p>
                <p>- Service worker and all caches</p>
                <p>- Any site data stored by this app</p>
                <p style="margin-top: 0.75rem;">The page will reload afterward.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelResetBtn">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmResetBtn">Reset Everything</button>
            </div>
        </div>
    </div>

    <script>
    (function(){
        function loadConfigJs(versionQuery){
            var s = document.createElement('script');
            s.src = 'config.js' + versionQuery;
            s.defer = false;
            document.body.appendChild(s);
        }

        try {
            fetch('/api/session-stats', { cache: 'no-store' })
                .then(function(r){ return r.ok ? r.json() : null; })
                .then(function(d){
                    var vq = d && d.version ? ('?v=' + d.version) : ('?v=' + Date.now());
                    loadConfigJs(vq);
                })
                .catch(function(){
                    loadConfigJs('?v=' + Date.now());
                });
        } catch (e) {
            loadConfigJs('?v=' + Date.now());
        }
    })();

    // Theme switching functionality
    (function() {
        const html = document.documentElement;
        const themeToggle = document.getElementById('themeToggle');

        // Check for saved theme preference or default to system preference
        function getPreferredTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                return savedTheme;
            }

            // Check system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                return 'dark';
            }

            return 'light';
        }

        // Apply theme
        function setTheme(theme) {
            html.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        // Initialize theme on page load
        const initialTheme = getPreferredTheme();
        setTheme(initialTheme);

        // Toggle theme on button click - cycles through light → dark → true-dark → light
        function spawnCoin(x, y) {
            try {
                const c = document.createElement('div');
                c.className = 'coin animate';
                c.style.left = x + 'px';
                c.style.top = y + 'px';
                document.body.appendChild(c);
                c.addEventListener('animationend', () => c.remove(), { once: true });
                setTimeout(() => { if (c && c.parentNode) c.remove(); }, 1200);
            } catch (_) {}
        }

        if (themeToggle) {
            themeToggle.addEventListener('click', function(e) {
                const currentTheme = html.getAttribute('data-theme') || 'light';
                let newTheme;

                if (currentTheme === 'light') {
                    newTheme = 'dark';
                } else if (currentTheme === 'dark') {
                    newTheme = 'true-dark';
                } else {
                    newTheme = 'light';
                }

                setTheme(newTheme);
                if (e && e.clientX != null && e.clientY != null) {
                    spawnCoin(e.clientX, e.clientY);
                }
            });
        }

        // Listen for system theme changes
        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                // Only auto-switch if user hasn't manually set a preference
                if (!localStorage.getItem('theme')) {
                    setTheme(e.matches ? 'dark' : 'light');
                }
            });
        }
    })();
    </script>

    <!-- Help/Instructions wiring (config page) -->
    <script>
    (function(){
        try {
            var helpBtn = document.getElementById('configHelp');
            var overlay = document.getElementById('instructionsModal');
            var closeBtn = document.getElementById('closeInstructionsBtn');
            var gotItBtn = document.getElementById('gotItInstructionsBtn');
            var dontShow = document.getElementById('dontShowInstructions');

            function openModal(){ if (overlay) overlay.classList.add('show'); }
            function closeModal(){ if (overlay){ overlay.classList.remove('show'); overlay.classList.remove('fly-out'); } }

            if (helpBtn) helpBtn.addEventListener('click', openModal);
            if (closeBtn) closeBtn.addEventListener('click', closeModal);
            if (overlay) overlay.addEventListener('click', function(e){ if (e.target === overlay) closeModal(); });
            document.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeModal(); });
            if (gotItBtn) gotItBtn.addEventListener('click', function(){
                if (dontShow && dontShow.checked) localStorage.setItem('hideConfigInstructions', '1');
                closeModal();
            });

            // Optional: auto-open once unless dismissed
            try {
                if (!localStorage.getItem('hideConfigInstructions')) {
                    // Do not auto-open to avoid interrupting; keep for future if desired
                }
            } catch (_) {}
        } catch (_) {}
    })();
    </script>

    <!-- Service Worker Registration for Cache Management -->
    <script>
        /**
         * Register service worker for automatic cache version management
         * This ensures users always get the latest version when deployed
         */
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js', { scope: '/' })
                    .then(function(reg) {
                        // Check for updates periodically (every hour)
                        setInterval(function() {
                            reg.update().catch(function(){});
                        }, 60 * 60 * 1000);

                        // Listen for controller change (indicates new SW activated)
                        navigator.serviceWorker.addEventListener('controllerchange', function() {
                            // no-op
                        });
                    })
                    .catch(function(){ /* no-op */ });
            });

            // Listen for messages from service worker
            navigator.serviceWorker.addEventListener('message', function(){});
        }
    </script>
</body>
</html>
